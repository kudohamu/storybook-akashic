/*! v1.0.0 */
export var AE=function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=74)}([function(t,e,i){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),r(i(31)),r(i(81))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExceptionFactory=void 0,function(t){t.createAssertionError=function(t,e){var i=new Error(t);return i.name="AssertionError",i.cause=e,i},t.createTypeMismatchError=function(t,e,i,r){var o="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var n;o+=", actual type is "+((n=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i).length>40?n.substr(0,40):n)}catch(t){}o+=".";var s=new Error(o);return s.name="TypeMismatchError",s.cause=r,s.expected=e,s.actual=i,s},t.createAssetLoadError=function(t,e,i,r){void 0===e&&(e=!0),void 0===i&&(i=null);var o=new Error(t);return o.name="AssetLoadError",o.cause=r,o.retriable=e,o}}(e.ExceptionFactory||(e.ExceptionFactory={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Asset=void 0;var r=i(0),o=function(){function t(t,e){this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e),this.onDestroyed=new r.Trigger}return t.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},t.prototype.destroyed=function(){return void 0===this.id},t.prototype.inUse=function(){return!1},t.prototype._assetPathFilter=function(t){return t},t}();e.Asset=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.E=e.PointMoveEvent=e.PointUpEvent=e.PointDownEvent=void 0;var n=i(0),s=i(20),a=i(1),h=i(11),u=i(12),c=i(4),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(s.PointDownEventBase);e.PointDownEvent=l;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(s.PointUpEventBase);e.PointUpEvent=d;var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(s.PointMoveEventBase);e.PointMoveEvent=p;var f=function(t){function e(e){var i=t.call(this,e)||this;if(i.children=void 0,i.parent=void 0,i._touchable=!1,i.state=0,i._hasTouchableChildren=!1,i._onUpdate=void 0,i._onMessage=void 0,i._onPointDown=void 0,i._onPointMove=void 0,i._onPointUp=void 0,i.tag=e.tag,i.shaderProgram=e.shaderProgram,i.local="non-local"!==e.scene.local||!!e.local,e.children)for(var r=0;r<e.children.length;++r)i.append(e.children[r]);return e.parent&&e.parent.append(i),null!=e.touchable&&(i.touchable=e.touchable),e.hidden&&i.hide(),i.id=e.id,e.scene.register(i),i}return o(e,t),Object.defineProperty(e.prototype,"onUpdate",{get:function(){return this._onUpdate||(this._onUpdate=new n.ChainTrigger(this.scene.onUpdate)),this._onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{get:function(){return this._onMessage||(this._onMessage=new n.ChainTrigger(this.scene.onMessage)),this._onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onPointDown",{get:function(){return this._onPointDown||(this._onPointDown=new n.ChainTrigger(this.scene.onPointDownCapture,this._isTargetOperation,this)),this._onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onPointUp",{get:function(){return this._onPointUp||(this._onPointUp=new n.ChainTrigger(this.scene.onPointUpCapture,this._isTargetOperation,this)),this._onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onPointMove",{get:function(){return this._onPointMove||(this._onPointMove=new n.ChainTrigger(this.scene.onPointMoveCapture,this._isTargetOperation,this)),this._onPointMove},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"update",{get:function(){return this.onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointDown",{get:function(){return this.onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointUp",{get:function(){return this.onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointMove",{get:function(){return this.onPointMove},enumerable:!1,configurable:!0}),e.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state))if(8&this.state){if(t.translate(this.x,this.y),this.renderSelf(t,e)&&this.children)for(var i=(n=this.children).length,r=0;r<i;++r)n[r].render(t,e);t.translate(-this.x,-this.y)}else{t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity);var o=this.compositeOperation;if(void 0!==o&&t.setCompositeOperation("string"==typeof o?o:c.Util.compositeOperationStringTable[o]),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram),this.renderSelf(t,e)&&this.children){var n=this.children;for(r=0;r<n.length;++r)n[r].render(t,e)}t.restore()}},e.prototype.renderSelf=function(t,e){return!0},e.prototype.game=function(){return this.scene.game},e.prototype.append=function(t){this.insertBefore(t,void 0)},e.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},e.prototype.remove=function(t){if(void 0!==t){var e=this.children?this.children.indexOf(t):-1;if(e<0)throw a.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[e].parent=void 0,this.children.splice(e,1),(t._touchable||t._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)}else this.parent.remove(this)},e.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var t=this.children.length-1;t>=0;--t)this.children[t].destroy();if(0!==this.children.length)throw a.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._onUpdate&&(this._onUpdate.destroy(),this._onUpdate=void 0),this._onMessage&&(this._onMessage.destroy(),this._onMessage=void 0),this._onPointDown&&(this._onPointDown.destroy(),this._onPointDown=void 0),this._onPointMove&&(this._onPointMove.destroy(),this._onPointMove=void 0),this._onPointUp&&(this._onPointUp.destroy(),this._onPointUp=void 0),this.scene.unregister(this)},e.prototype.destroyed=function(){return void 0===this.scene},e.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},e.prototype.shouldFindChildrenByPoint=function(t){return!0},e.prototype.findPointSourceByPoint=function(t,e,i){if(!(1&this.state)){var r=(e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone()).multiplyInverseForPoint(t);if(this._hasTouchableChildren||i&&this.children&&this.children.length){var o=this.children;if(this.shouldFindChildrenByPoint(r))for(var n=o.length-1;n>=0;--n){var s=o[n];if(i||s._touchable||s._hasTouchableChildren){var a=s.findPointSourceByPoint(t,e,i);if(a)return a}}}if(i||this._touchable)return 0<=r.x&&this.width>r.x&&0<=r.y&&this.height>r.y?{target:this,point:r}:void 0}},e.prototype.visible=function(){return 1!=(1&this.state)},e.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},e.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},e.prototype.calculateBoundingRect=function(){return this._calculateBoundingRect(void 0)},e.prototype.localToGlobal=function(t){for(var i=t,r=this;r instanceof e;r=r.parent)i=r.getMatrix().multiplyPoint(i);return i},e.prototype.globalToLocal=function(t){for(var i=new h.PlainMatrix,r=this;r instanceof e;r=r.parent)i.multiplyLeft(r.getMatrix());return i.multiplyInverseForPoint(t)},e.prototype._calculateMatrixTo=function(t){for(var i=new h.PlainMatrix,r=this;r instanceof e&&r!==t;r=r.parent)i.multiplyLeft(r.getMatrix());return i},e.prototype._findLowestCommonAncestorWith=function(t){for(var i={},r=this;r instanceof e;r=r.parent)i[r.id]=!0;for(var o=t;o instanceof e&&!i.hasOwnProperty(o.id);o=o.parent);return o},e.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var i={left:0,right:this.width,top:0,bottom:this.height},r=[{x:i.left,y:i.top},{x:i.left,y:i.bottom},{x:i.right,y:i.top},{x:i.right,y:i.bottom}],o=e.multiplyPoint(r[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},s=1;s<r.length;++s)o=e.multiplyPoint(r[s]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);if(void 0!==this.children)for(s=0;s<this.children.length;++s){var a=this.children[s]._calculateBoundingRect(e);a&&(n.left>a.left&&(n.left=a.left),n.right<a.right&&(n.right=a.right),n.top>a.top&&(n.top=a.top),n.bottom<a.bottom&&(n.bottom=a.bottom))}return n}},e.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof e&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},e.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof e&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},e.prototype._isTargetOperation=function(t){return!(1&this.state)&&(t instanceof s.PointEventBase&&(this._touchable&&t.target===this))},e.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},e}(u.Object2D);e.E=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Util=void 0;var r=i(14);!function(t){var e;t.distance=function(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))},t.distanceBetweenOffsets=function(e,i){return t.distance(e.x,e.y,i.x,i.y)},t.distanceBetweenAreas=function(e,i){return t.distance(e.x+e.width/2,e.y+e.height/2,i.x+i.width/2,i.y+i.height/2)},t.charCodeAt=function(t,e){var i=t.charCodeAt(e);return 55296<=i&&i<=56319?i<<16|t.charCodeAt(e+1):56320<=i&&i<=57343?null:i},t.enumToSnakeCase=function(t,e){var i=t[e];return i[0].toLowerCase()+i.slice(1).replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}))},t.compositeOperationStringTable=((e={})[r.CompositeOperation.SourceOver]="source-over",e[r.CompositeOperation.SourceAtop]="source-atop",e[r.CompositeOperation.Lighter]="lighter",e[r.CompositeOperation.Copy]="copy",e[r.CompositeOperation.ExperimentalSourceIn]="experimental-source-in",e[r.CompositeOperation.ExperimentalSourceOut]="experimental-source-out",e[r.CompositeOperation.ExperimentalDestinationAtop]="experimental-destination-atop",e[r.CompositeOperation.ExperimentalDestinationIn]="experimental-destination-in",e[r.CompositeOperation.DestinationOut]="destination-out",e[r.CompositeOperation.DestinationOver]="destination-over",e[r.CompositeOperation.Xor]="xor",e)}(e.Util||(e.Util={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExceptionFactory=void 0,function(t){t.createAssetLoadError=function(t,e,i){return void 0===e&&(e=!0),{name:"AssetLoadError",message:t,retriable:e,cause:i}}}(e.ExceptionFactory||(e.ExceptionFactory={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Asset=void 0;var r=i(0),o=function(){function t(t,e){this.onDestroyed=new r.Trigger,this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e)}return t.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},t.prototype.destroyed=function(){return void 0===this.id},t.prototype.inUse=function(){return!1},t.prototype._assetPathFilter=function(t){return t},t}();e.Asset=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurfaceUtil=void 0;var r=i(1);!function(t){t.asSurface=function(t){if(t){if("type"in t&&"image"===t.type)return t.asSurface();if("_drawable"in t)return t;throw r.ExceptionFactory.createTypeMismatchError("SurfaceUtil#asSurface","ImageAsset|Surface",t)}},t.setupAnimatingHandler=function(t,e){e.isPlaying()&&t._handleAnimationStart()},t.migrateAnimatingHandler=function(t,e,i){t._handleAnimationStop(),i.isPlaying()&&t._handleAnimationStart()},t.drawNinePatch=function(t,e,i){void 0===i&&(i=4);var r,o=t.renderer(),n=t.width,s=t.height;r="number"==typeof i?{top:i,bottom:i,left:i,right:i}:i,o.begin(),o.clear();for(var a=r.left,h=e.width-r.right,u=r.top,c=e.height-r.bottom,l=r.left,d=n-r.right,p=r.top,f=s-r.bottom,_=[{x:0,y:0,width:r.left,height:r.top},{x:h,y:0,width:r.right,height:r.top},{x:0,y:c,width:r.left,height:r.bottom},{x:h,y:c,width:r.right,height:r.bottom}],y=[{x:0,y:0},{x:d,y:0},{x:0,y:f},{x:d,y:f}],v=0;v<_.length;++v){var g=_[v];o.save(),o.translate(y[v].x,y[v].y),o.drawImage(e,g.x,g.y,g.width,g.height,0,0),o.restore()}var m=[{x:a,y:0,width:h-a,height:r.top},{x:0,y:u,width:r.left,height:c-u},{x:h,y:u,width:r.right,height:c-u},{x:a,y:c,width:h-a,height:r.bottom}],A=[{x:l,y:0,width:d-l,height:r.top},{x:0,y:p,width:r.left,height:f-p},{x:d,y:p,width:r.right,height:f-p},{x:l,y:f,width:d-l,height:r.bottom}];for(v=0;v<m.length;++v){var x=m[v],P=A[v];o.save(),o.translate(P.x,P.y),o.transform([P.width/x.width,0,0,P.height/x.height,0,0]),o.drawImage(e,x.x,x.y,x.width,x.height,0,0),o.restore()}var S=h-a,b=c-u,w=d-l,E=f-p;o.save(),o.translate(l,p),o.transform([w/S,0,0,E/b,0,0]),o.drawImage(e,a,u,S,b,0,0),o.restore(),o.end()}}(e.SurfaceUtil||(e.SurfaceUtil={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Surface=void 0;var r=function(){function t(t,e,i){if(this.width=t,this.height=e,this._drawable=i,t%1!=0||e%1!=0)throw new Error("Surface#constructor: width and height must be integers");this.width=t,this.height=e,this._drawable=i}return t.prototype.destroy=function(){this._destroyed=!0},t.prototype.destroyed=function(){return!!this._destroyed},t}();e.Surface=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.XHRLoader=void 0;var r=i(5),o=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},t.prototype._getRequestObject=function(t,e){var i=new XMLHttpRequest;i.open("GET",t.url,!0),i.responseType=t.responseType,i.timeout=this.timeout,i.addEventListener("timeout",(function(){e(r.ExceptionFactory.createAssetLoadError("loading timeout"))}),!1),i.addEventListener("load",(function(){if(i.status>=200&&i.status<300){var o="text"===t.responseType?i.responseText:i.response;e(null,o)}else e(r.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))}),!1),i.addEventListener("error",(function(){e(r.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))}),!1),i.send()},t}();e.XHRLoader=o},function(t,e,i){t.exports=i(75)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PlainMatrix=void 0;var r=function(){function t(t,e,i,r,o,n,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),this.update(t,e,i,r,o,0,0,n,s)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,o,n,s,a,h){if(null!=a&&null!=h){var u=o*Math.PI/180,c=Math.cos(u),l=Math.sin(u),d=c*i,p=l*i,f=l*r,_=c*r,y=a*t,v=h*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*y+f*v+n,this._matrix[5]=-p*y-_*v+s}else this._updateWithoutAnchor(t,e,i,r,o,n,s)},t.prototype._updateWithoutAnchor=function(t,e,i,r,o,n,s){var a=o*Math.PI/180,h=Math.cos(a),u=Math.sin(a),c=h*i,l=u*i,d=u*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=c,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-c*f+d*_+f+n,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateByInverse=function(t,e,i,r,o,n,s,a,h){if(null!=a&&null!=h){var u=o*Math.PI/180,c=Math.cos(u),l=Math.sin(u),d=c/i,p=l/r,f=l/i,_=c/r,y=a*t,v=h*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*n-f*s+y,this._matrix[5]=p*n-_*s+v}else this._updateByInverseWithoutAnchor(t,e,i,r,o,n,s)},t.prototype._updateByInverseWithoutAnchor=function(t,e,i,r,o,n,s){var a=o*Math.PI/180,h=Math.cos(a),u=Math.sin(a),c=h/i,l=u/r,d=u/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=c,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-c*(f+n)-d*(_+s)+f,this._matrix[5]=l*(f+n)-p*(_+s)+_},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],o=e[1],n=e[2],s=e[3];e[0]=r*i[0]+n*i[1],e[1]=o*i[0]+s*i[1],e[2]=r*i[2]+n*i[3],e[3]=o*i[2]+s*i[3],e[4]=r*i[4]+n*i[5]+e[4],e[5]=o*i[4]+s*i[5]+e[5]},t.prototype.multiplyLeft=function(t){var e=t._matrix,i=this._matrix,r=i[0],o=i[2],n=i[4];i[0]=e[0]*r+e[2]*i[1],i[1]=e[1]*r+e[3]*i[1],i[2]=e[0]*o+e[2]*i[3],i[3]=e[1]*o+e[3]*i[3],i[4]=e[0]*n+e[2]*i[5]+e[4],i[5]=e[1]*n+e[3]*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();e.PlainMatrix=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Object2D=void 0;var r=i(1),o=i(11),n=function(){function t(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=null!=t.opacity?t.opacity:1,this.scaleX=null!=t.scaleX?t.scaleX:1,this.scaleY=null!=t.scaleY?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=void 0===t.anchorX?0:t.anchorX,this.anchorY=void 0===t.anchorY?0:t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=0,this.anchorY=0,this._matrix=void 0)}return t.prototype.moveTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw r.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof t?(this.x=t,this.y=e):(this.x=t.x,this.y=t.y)},t.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},t.prototype.resizeTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw r.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof t?(this.width=t,this.height=e):(this.width=t.width,this.height=t.height)},t.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},t.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},t.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},t.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=new o.PlainMatrix;return this._updateMatrix(),this._matrix._modified=!1,this._matrix},t.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(this.x,this.y)},t}();e.Object2D=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Context2DSurface=void 0;var n=i(59),s=i(60),a=i(62),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.context=function(){return this._context||(this._context=new s.CanvasSurfaceContext(this.canvas.getContext("2d"))),this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new a.Context2DRenderer(this)),this._renderer},e.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);e.Context2DSurface=h},function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),o(i(82),e),o(i(83),e),o(i(84),e),o(i(85),e),o(i(86),e),o(i(87),e),o(i(88),e),o(i(89),e),o(i(90),e),o(i(91),e),o(i(92),e),o(i(93),e),o(i(94),e),o(i(95),e),o(i(96),e),o(i(97),e),o(i(98),e),o(i(99),e),o(i(100),e),o(i(101),e),o(i(102),e),o(i(103),e),o(i(104),e),o(i(105),e),o(i(106),e),o(i(107),e),o(i(108),e),o(i(109),e),o(i(110),e),o(i(111),e),o(i(112),e),o(i(113),e),o(i(114),e),o(i(115),e),o(i(116),e),o(i(117),e),o(i(118),e),o(i(119),e),o(i(120),e)},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.SoundAudioSystem=e.MusicAudioSystem=e.AudioSystem=void 0;var n=i(1),s=function(){function t(t){this.id=t.id,this._volume=t.volume||1,this._destroyRequestedAssets={},this._explicitMuted=t.muted||!1,this._suppressed=!1,this._muted=!1,this._resourceFactory=t.resourceFactory,this._updateMuted()}return Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0||t>1||isNaN(t)||"number"!=typeof t)throw n.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+t);this._volume=t,this._onVolumeChanged()},enumerable:!1,configurable:!0}),t.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},t.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=!1,this._suppressed=!1,this._explicitMuted=!1},t.prototype._setMuted=function(t){var e=this._explicitMuted;this._explicitMuted=!!t,this._explicitMuted!==e&&(this._updateMuted(),this._onMutedChanged())},t.prototype._setPlaybackRate=function(t){if(t<0||isNaN(t)||"number"!=typeof t)throw n.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+t);this._suppressed=1!==t,this._updateMuted()},t.prototype._updateMuted=function(){this._muted=this._explicitMuted||this._suppressed},t}();e.AudioSystem=s;var a=function(t){function e(e){var i=t.call(this,e)||this;return i._player=void 0,i}return o(e,t),Object.defineProperty(e.prototype,"player",{get:function(){return this._player||(this._player=this._resourceFactory.createAudioPlayer(this),this._player.onPlay.add(this._handlePlay,this),this._player.onStop.add(this._handleStop,this)),this._player},set:function(t){this._player=t},enumerable:!1,configurable:!0}),e.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},e.prototype.createPlayer=function(){return this.player},e.prototype.stopAll=function(){this._player&&this._player.stop()},e.prototype._reset=function(){t.prototype._reset.call(this),this._player&&(this._player.onPlay.remove(this._handlePlay,this),this._player.onStop.remove(this._handleStop,this)),this._player=void 0},e.prototype._onVolumeChanged=function(){this.player._notifyVolumeChanged()},e.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},e.prototype._setPlaybackRate=function(e){t.prototype._setPlaybackRate.call(this,e),this.player._changeMuted(this._muted)},e.prototype._handlePlay=function(t){if(t.player!==this._player)throw n.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player")},e.prototype._handleStop=function(t){this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},e}(s);e.MusicAudioSystem=a;var h=function(t){function e(e){var i=t.call(this,e)||this;return i.players=[],i}return o(e,t),e.prototype.createPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.onPlay.add(this._handlePlay,this),t.onStop.add(this._handleStop,this),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i){var r=this.players[i].currentAudio;r&&r.id===t.id&&e.push(this.players[i])}return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var i=this.players[e];i.onPlay.remove(this._handlePlay,this),i.onStop.remove(this._handleStop,this)}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._setPlaybackRate=function(e){t.prototype._setPlaybackRate.call(this,e);var i=this.players;if(this._suppressed)for(var r=0;r<i.length;++r)i[r]._changeMuted(!0)},e.prototype._handlePlay=function(t){},e.prototype._handleStop=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.onStop.remove(this._handleStop,this),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t]._notifyVolumeChanged()},e}(s);e.SoundAudioSystem=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Module=void 0;var r=i(17),o=function(t){var e=this,i=t.path,o=r.PathUtil.resolveDirname(i),n=t.virtualPath,s=n?r.PathUtil.resolveDirname(n):void 0,a=t.requireFunc,h=t.resolveFunc;this._runtimeValue=Object.create(t.runtimeValueBase,{filename:{value:i,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}}),this.id=t.id,this.filename=t.path,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=s?r.PathUtil.makeNodeModulePaths(s):[],this._dirname=o,this._virtualDirname=s;var u=function(t){return a(t,e)};u.resolve=function(t){return h(t,e)},this.require=u};e.Module=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PathUtil=void 0;var r=i(1);!function(t){t.resolvePath=function(e,i){function o(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===i)return e;for(var n=t.splitPath(e),s=o(n.path).concat(o(i)),a=[],h=0;h<s.length;++h){var u=s[h];switch(u){case"..":var c=a.pop();if(void 0===c||""===c||"."===c)throw r.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===a.length&&a.push(".");break;case"":a=[""];break;default:a.push(u)}}return n.host+a.join("/")},t.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},t.resolveExtname=function(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""},t.makeNodeModulePaths=function(e){var i=t.splitPath(e),r=i.host;"/"===(e=i.path)[e.length-1]&&(e=e.slice(0,e.length-1));for(var o=e.split("/"),n=o.indexOf("node_modules"),s=n>0?n-1:0,a=[],h=o.length-1;h>=s;--h)if("node_modules"!==o[h]){var u=o.slice(0,h+1);u.push("node_modules");var c=u.join("/");a.push(r+c)}return a},t.splitPath=function(t){var e="",i=t.indexOf("//");if(i>=0){var r=t.indexOf("/",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t="/")}else e="";return{host:e,path:t}}}(e.PathUtil||(e.PathUtil={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VideoSystem=void 0;var r=function(){};e.VideoSystem=r},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.CacheableE=void 0;var n=function(t){function e(e){var i=t.call(this,e)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return o(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,i){var r=e.PADDING;if(this._renderedCamera!==i&&(this.state&=-3,this._renderedCamera=i),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var o=Math.ceil(this._cacheSize.width)+2*r,n=Math.ceil(this._cacheSize.height)+2*r,s=!this._cache||this._cache.width<o||this._cache.height<n;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(o,n),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(r,r),this.renderCache(a,i),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-r,-r),this.renderSelfFromCache(t),t.translate(r,r)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e.PADDING=1,e}(i(3).E);e.CacheableE=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.SeedEvent=e.PlayerInfoEvent=e.TimestampEvent=e.LeaveEvent=e.JoinEvent=e.OperationEvent=e.MessageEvent=e.PointMoveEventBase=e.PointUpEventBase=e.PointDownEventBase=e.PointEventBase=void 0;var n=function(t,e,i,r,o,n){this.eventFlags=n,this.local=!!o,this.player=r,this.pointerId=t,this.target=e,this.point=i};e.PointEventBase=n;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="point-down",e}return o(e,t),e}(n);e.PointDownEventBase=s;var a=function(t){function e(e,i,r,o,n,s,a,h){var u=t.call(this,e,i,r,s,a,h)||this;return u.type="point-up",u.prevDelta=o,u.startDelta=n,u}return o(e,t),e}(n);e.PointUpEventBase=a;var h=function(t){function e(e,i,r,o,n,s,a,h){var u=t.call(this,e,i,r,s,a,h)||this;return u.type="point-move",u.prevDelta=o,u.startDelta=n,u}return o(e,t),e}(n);e.PointMoveEventBase=h;var u=function(t,e,i,r){this.type="message",this.eventFlags=r,this.local=!!i,this.player=e,this.data=t};e.MessageEvent=u;var c=function(t,e,i,r,o){this.type="operation",this.eventFlags=o,this.local=!!r,this.player=i,this.code=t,this.data=e};e.OperationEvent=c;var l=function(t,e,i){this.type="join",this.eventFlags=i,this.player=t,this.storageValues=e};e.JoinEvent=l;var d=function(t,e){this.type="leave",this.eventFlags=e,this.player=t};e.LeaveEvent=d;var p=function(t,e,i){this.type="timestamp",this.eventFlags=i,this.player=e,this.timestamp=t};e.TimestampEvent=p;var f=function(t,e){this.type="player-info",this.eventFlags=e,this.player=t};e.PlayerInfoEvent=f;var _=function(t,e){this.type="seed",this.eventFlags=e,this.generator=t};e.SeedEvent=_},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var n=i(11),s=i(7),a=function(t){function e(e){var i=t.call(this,e)||this;return i.src=e.src,"_drawable"in e.src?i._surface=e.src:i._surface=s.SurfaceUtil.asSurface(e.src),null==e.width&&(i.width=i._surface.width),null==e.height&&(i.height=i._surface.height),i.srcWidth=null!=e.srcWidth?e.srcWidth:i.width,i.srcHeight=null!=e.srcHeight?e.srcHeight:i.height,i.srcX=e.srcX||0,i.srcY=e.srcY||0,i._stretchMatrix=void 0,i._beforeSrc=i.src,i._beforeSurface=i._surface,s.SurfaceUtil.setupAnimatingHandler(i,i._surface),i._invalidateSelf(),i}return o(e,t),e.prototype._handleUpdate=function(){this.modified()},e.prototype._handleAnimationStart=function(){this.onUpdate.contains(this._handleUpdate,this)||this.onUpdate.add(this._handleUpdate,this)},e.prototype._handleAnimationStop=function(){this.destroyed()||this.onUpdate.remove(this._handleUpdate,this)},e.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this._surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore()),!0},e.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},e.prototype.destroy=function(e){this._surface&&!this._surface.destroyed()&&e&&this._surface.destroy(),this.src=void 0,this._beforeSrc=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=new n.PlainMatrix,this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.src!==this._beforeSrc&&(this._beforeSrc=this.src,"_drawable"in this.src?this._surface=this.src:this._surface=s.SurfaceUtil.asSurface(this.src)),this._surface!==this._beforeSurface&&(s.SurfaceUtil.migrateAnimatingHandler(this,this._beforeSurface,this._surface),this._beforeSurface=this._surface)},e}(i(3).E);e.Sprite=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Font=void 0;var r=i(4),o=function(){function t(){}return t.prototype.measureText=function(t){for(var e=0,i=0,o=0,n=null,s=0;s<t.length;s++){var a=r.Util.charCodeAt(t,s);if(a){var h=this.glyphForCharacter(a);!h||h.x<0||h.y<0||h.width<0||h.height<0||(0===s&&(i=-h.offsetX),n=h,e+=h.advanceWidth)}}return n&&(o=e+n.offsetX+n.width-n.advanceWidth),{width:e,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}},t}();e.Font=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.LoadingScene=void 0;var n=i(0),s=i(1),a=function(t){function e(e){var i=this;return e.local=!0,(i=t.call(this,e)||this).onTargetReset=new n.Trigger,i.onTargetReady=new n.Trigger,i.onTargetAssetLoad=new n.Trigger,i.targetReset=i.onTargetReset,i.targetReady=i.onTargetReady,i.targetAssetLoaded=i.onTargetAssetLoad,i._explicitEnd=!!e.explicitEnd,i._targetScene=void 0,i}return o(e,t),e.prototype.destroy=function(){this._clearTargetScene(),t.prototype.destroy.call(this)},e.prototype.reset=function(t){this._clearTargetScene(),this._targetScene=t,"loaded-fired"!==this._loadingState?this.onLoad.addOnce(this._doReset,this):this._doReset()},e.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},e.prototype.end=function(){if(!this._targetScene||"initial"===this._targetScene._loadingState){var t="LoadingScene#end(): the target scene is in invalid state: "+(this._targetScene?this._targetScene._loadingState:"(no scene)");throw s.ExceptionFactory.createAssertionError(t)}this.game.popScene(!0),this.game._pushPostTickTask(this._targetScene._fireLoaded,this._targetScene),this._clearTargetScene()},e.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._onReady.removeAll({owner:this}),this._targetScene.onAssetLoad.removeAll({owner:this}),this._targetScene=void 0)},e.prototype._doReset=function(){this.onTargetReset.fire(this._targetScene),"initial"===this._targetScene._loadingState||"ready"===this._targetScene._loadingState?(this._targetScene._onReady.add(this._handleReady,this),this._targetScene.onAssetLoad.add(this._handleAssetLoad,this),this._targetScene._load()):this._handleReady(this._targetScene)},e.prototype._handleAssetLoad=function(t){this.onTargetAssetLoad.fire(t)},e.prototype._handleReady=function(t){this.onTargetReady.fire(t),this._explicitEnd||this.end()},e}(i(24).Scene);e.LoadingScene=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;var r=i(0),o=i(35),n=i(129),s=i(39),a=i(1),h=i(41),u=function(){function t(t){var e=t.game,i=void 0===t.local||!1===t.local?"non-local":!0===t.local?"full-local":t.local,s=void 0!==t.tickGenerationMode?t.tickGenerationMode:"by-clock";t.storageKeys?(this._storageLoader=e.storage._createLoader(t.storageKeys,t.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),this.name=t.name,this.game=e,this.local=i,this.tickGenerationMode=s,this.onLoad=new r.Trigger,this.loaded=this.onLoad,this._onReady=new r.Trigger,this._ready=this._onReady,this.assets={},this.asset=new o.AssetAccessor(e._assetManager),this._loaded=!1,this._prefetchRequested=!1,this._loadingState="initial",this.onUpdate=new r.Trigger,this.update=this.onUpdate,this._timer=new h.TimerManager(this.onUpdate,this.game.fps),this.onAssetLoad=new r.Trigger,this.onAssetLoadFailure=new r.Trigger,this.onAssetLoadComplete=new r.Trigger,this.assetLoaded=this.onAssetLoad,this.assetLoadFailed=this.onAssetLoadFailure,this.assetLoadCompleted=this.onAssetLoadComplete,this.onMessage=new r.Trigger,this.onPointDownCapture=new r.Trigger,this.onPointMoveCapture=new r.Trigger,this.onPointUpCapture=new r.Trigger,this.onOperation=new r.Trigger,this.message=this.onMessage,this.pointDownCapture=this.onPointDownCapture,this.pointMoveCapture=this.onPointMoveCapture,this.pointUpCapture=this.onPointUpCapture,this.operation=this.onOperation,this.children=[],this.state="standby",this.onStateChange=new r.Trigger,this._assetHolders=[],this._sceneAssetHolder=new n.AssetHolder({assetManager:this.game._assetManager,assetIds:t.assetIds,assetPaths:t.assetPaths,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:null})}return t.prototype.modified=function(t){this.game.modified()},t.prototype.destroy=function(){this.state="before-destroyed",this.onStateChange.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.onUpdate.destroy(),this.onMessage.destroy(),this.onPointDownCapture.destroy(),this.onPointMoveCapture.destroy(),this.onPointUpCapture.destroy(),this.onOperation.destroy(),this.onLoad.destroy(),this.onAssetLoad.destroy(),this.onAssetLoadFailure.destroy(),this.onAssetLoadComplete.destroy(),this.assets={};for(var i=0;i<this._assetHolders.length;++i)this._assetHolders[i].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state="destroyed",this.onStateChange.fire(this.state),this.onStateChange.destroy()},t.prototype.destroyed=function(){return void 0===this.game},t.prototype.createTimer=function(t){return this._timer.createTimer(t)},t.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},t.prototype.setInterval=function(t,e,i){return this._timer.setInterval(t,e,i)},t.prototype.clearInterval=function(t){this._timer.clearInterval(t)},t.prototype.setTimeout=function(t,e,i){return this._timer.setTimeout(t,e,i)},t.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},t.prototype.isCurrentScene=function(){return this.game.scene()===this},t.prototype.gotoScene=function(t,e){if(!this.isCurrentScene())throw a.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");e?this.game.pushScene(t):this.game.replaceScene(t)},t.prototype.end=function(){if(!this.isCurrentScene())throw a.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},t.prototype.register=function(t){this.game.register(t),t.scene=this},t.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},t.prototype.append=function(t){this.insertBefore(t,void 0)},t.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},t.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},t.prototype.findPointSourceByPoint=function(t,e,i){for(var r="non-local"!==this.local,o=this.children,n=i&&i instanceof s.Camera2D?i.getMatrix():void 0,a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(t,n,e);if(h)return h.local=h.target&&h.target.local||r,h}return{target:void 0,point:void 0,local:r}},t.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},t.prototype.serializeStorageValues=function(){if(this._storageLoader)return this._storageLoader._valueStoreSerialization},t.prototype.requestAssets=function(t,e){var i=this;if("ready-fired"!==this._loadingState&&"loaded-fired"!==this._loadingState)throw a.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");var r=new n.AssetHolder({assetManager:this.game._assetManager,assetIds:t,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:function(){i.destroyed()||e()}});this._assetHolders.push(r),r.request()},t.prototype._activate=function(){this.state="active",this.onStateChange.fire(this.state)},t.prototype._deactivate=function(){this.state="deactive",this.onStateChange.fire(this.state)},t.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||!!this._storageLoader&&!this._storageLoader._loaded},t.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},t.prototype._handleSceneAssetLoad=function(t){this.assets[t.id]=t,this.onAssetLoad.fire(t),this.onAssetLoadComplete.fire(t)},t.prototype._handleSceneAssetLoadFailure=function(t){this.onAssetLoadFailure.fire(t),this.onAssetLoadComplete.fire(t.asset)},t.prototype._handleSceneAssetLoadFinish=function(t,e){e?t.userData?this.game._pushPostTickTask(t.userData,null):this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady()):this.game.terminateGame()},t.prototype._onStorageLoadError=function(t){this.game.terminateGame()},t.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},t.prototype._notifySceneReady=function(){this._loadingState="ready",this.game._pushPostTickTask(this._fireReady,this)},t.prototype._fireReady=function(){this.destroyed()||(this._onReady.fire(this),this._loadingState="ready-fired")},t.prototype._fireLoaded=function(){this.destroyed()||"loaded-fired"!==this._loadingState&&(this.onLoad.fire(this),this._loadingState="loaded-fired")},t}();e.Scene=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurfaceAtlasSet=void 0;var r=i(43);var o=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.resourceFactory,this._currentAtlasIndex=0;var i=e.hint?e.hint:{};this._maxAtlasNum=i.maxAtlasNum?i.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,i.initialAtlasWidth=i.initialAtlasWidth?i.initialAtlasWidth:512,i.initialAtlasHeight=i.initialAtlasHeight?i.initialAtlasHeight:512,i.maxAtlasWidth=i.maxAtlasWidth?i.maxAtlasWidth:512,i.maxAtlasHeight=i.maxAtlasHeight?i.maxAtlasHeight:512,this._atlasSize=function(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}(i)}return t.prototype._deleteAtlas=function(t){for(var e=0;e<t;++e){var i=this._spliceLeastFrequentlyUsedAtlas();if(!i)return;i.destroy()}},t.prototype._findLeastFrequentlyUsedAtlasIndex=function(){for(var t=Number.MAX_VALUE,e=-1,i=0;i<this._surfaceAtlases.length;++i)this._surfaceAtlases[i]._accessScore<=t&&(t=this._surfaceAtlases[i]._accessScore,e=i);return e},t.prototype._spliceLeastFrequentlyUsedAtlas=function(){var t=this._findLeastFrequentlyUsedAtlasIndex();if(-1===t)return null;this._currentAtlasIndex>=t&&--this._currentAtlasIndex;for(var e=this._surfaceAtlases.splice(t,1)[0],i=this._atlasGlyphsTable.splice(t,1)[0],r=0;r<i.length;r++){var o=i[r];o.surface=void 0,o.isSurfaceValid=!1,o._atlas=null}return e},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],o=r.addSurface(t.surface,t.x,t.y,t.width,t.height);if(o)return this._currentAtlasIndex=i,t.surface&&t.surface.destroy(),t.surface=r._surface,t.x=o.x,t.y=o.y,t._atlas=r,this._atlasGlyphsTable[i].push(t),!0}return!1},t.prototype._reallocateAtlas=function(){var t=null;this._surfaceAtlases.length>=this._maxAtlasNum?(t=this._spliceLeastFrequentlyUsedAtlas()).reset():t=new r.SurfaceAtlas(this._resourceFactory.createSurface(this._atlasSize.width,this._atlasSize.height)),this._surfaceAtlases.push(t),this._atlasGlyphsTable.push([]),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasUsedSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){return!(t.width>this._atlasSize.width||t.height>this._atlasSize.height)&&(!!this._moveGlyphSurface(t)||(this._reallocateAtlas(),this._moveGlyphSurface(t)))},t.prototype.touchGlyph=function(t){t._atlas&&(t._atlas._accessScore+=1);for(var e=0;e<this._surfaceAtlases.length;e++){this._surfaceAtlases[e]._accessScore/=2}},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t.INITIAL_MAX_SURFACEATLAS_NUM=10,t}();e.SurfaceAtlasSet=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Storage=e.StorageLoader=e.StorageValueStore=e.StorageCountsOperation=e.StorageCondition=e.StorageOrder=e.StorageRegion=void 0,function(t){t[t.Slots=1]="Slots",t[t.Scores=2]="Scores",t[t.Counts=3]="Counts",t[t.Values=4]="Values"}(e.StorageRegion||(e.StorageRegion={})),function(t){t[t.Asc=0]="Asc",t[t.Desc=1]="Desc"}(e.StorageOrder||(e.StorageOrder={})),function(t){t[t.Equal=1]="Equal",t[t.GreaterThan=2]="GreaterThan",t[t.LessThan=3]="LessThan"}(e.StorageCondition||(e.StorageCondition={})),function(t){t[t.Incr=1]="Incr",t[t.Decr=2]="Decr"}(e.StorageCountsOperation||(e.StorageCountsOperation={}));var r=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},t}();e.StorageValueStore=r;var o=function(){function t(t,e,i){this._loaded=!1,this._storage=t,this._valueStore=new r(e),this._handler=void 0,this._valueStoreSerialization=i}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();e.StorageLoader=o;var n=function(){function t(){}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new o(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();e.Storage=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RenderingHelper=void 0,function(t){t.toPowerOfTwo=function(t){if(0!=(t&t-1)){for(var e=1;e<t;)e*=2;return e}return t},t.clamp=function(t){return Math.min(Math.max(t,0),1)},t.usedWebGL=function(t){var e=!1;return t&&0<t.length&&(e="webgl"===t[0]),e}}(e.RenderingHelper||(e.RenderingHelper={}))},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.AudioAsset=void 0;var n=function(t){function e(e,i,r,o,n,s){var a=t.call(this,e,i)||this;return a.type="audio",a.duration=r,a.loop=n,a.hint=s,a._system=o,a.data=void 0,a}return o(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(i(6).Asset);e.AudioAsset=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AudioPlayer=void 0;var r=i(0),o=function(){function t(t){this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.volume=t.volume,this._muted=t._muted,this._system=t}return t.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},t.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},t.prototype.canHandleStopped=function(){return!0},t.prototype.changeVolume=function(t){this.volume=t},t.prototype._changeMuted=function(t){this._muted=t},t.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},t}();e.AudioPlayer=o},function(t,e,i){"use strict";var r,o=window.AudioContext||window.webkitAudioContext;!function(t){t.getAudioContext=function(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var e=window.__akashic__.audioContext;return e instanceof o||(e=window.__akashic__.audioContext=new o,t._workAroundSafari()),e},t.createGainNode=function(t){return t.createGain?t.createGain():t.createGainNode()},t.createBufferNode=function(t){var e=t.createBufferSource();return e.start||(e.start=e.noteOn,e.stop=e.noteOff),e},t._workAroundSafari=function(){document.addEventListener("touchstart",(function e(){document.removeEventListener("touchstart",e),t.getAudioContext().createBufferSource().start(0)}),!0)}}(r||(r={})),t.exports=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._handlers=[],this.length=0}return t.prototype.add=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},t.prototype.addOnce=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},t.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var o=this._handlers.indexOf(r);-1!==o&&this._handlers.splice(o,1)}}null!=this._handlers&&(this.length=this._handlers.length)}},t.prototype.contains=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},t.prototype.remove=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var o=this._handlers[r];if(i.func===o.func&&i.owner===o.owner&&i.name===o.name)return this._handlers.splice(r,1),void--this.length}},t.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},t.prototype.destroy=function(){this._handlers=null,this.length=null},t.prototype.destroyed=function(){return null===this._handlers},t.prototype._comparePartial=function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&(void 0===t.name||t.name===e.name))},t}();e.Trigger=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ShaderProgram=void 0;var r=function(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms};e.ShaderProgram=r},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.FilledRect=void 0;var n=i(1),s=function(t){function e(e){var i=t.call(this,e)||this;if("string"!=typeof e.cssColor)throw n.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",e.cssColor);return i.cssColor=e.cssColor,i}return o(e,t),e.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},e}(i(3).E);e.FilledRect=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextAlign=void 0,function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(e.TextAlign||(e.TextAlign={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AssetAccessor=void 0;var r=function(){function t(t){this._assetManager=t}return t.prototype.getImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"image")},t.prototype.getAudio=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"audio")},t.prototype.getScript=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"script")},t.prototype.getText=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"text")},t.prototype.getTextContent=function(t){return this.getText(t).data},t.prototype.getJSONContent=function(t){return JSON.parse(this.getTextContent(t))},t.prototype.getVectorImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"vector-image")},t.prototype.getAllImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","image")},t.prototype.getAllAudios=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","audio")},t.prototype.getAllScripts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","script")},t.prototype.getAllTexts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","text")},t.prototype.getAllVectorImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","vector-image")},t.prototype.getImageById=function(t){return this._assetManager.peekLiveAssetById(t,"image")},t.prototype.getAudioById=function(t){return this._assetManager.peekLiveAssetById(t,"audio")},t.prototype.getScriptById=function(t){return this._assetManager.peekLiveAssetById(t,"script")},t.prototype.getTextById=function(t){return this._assetManager.peekLiveAssetById(t,"text")},t.prototype.getTextContentById=function(t){return this.getTextById(t).data},t.prototype.getJSONContentById=function(t){return JSON.parse(this.getTextById(t).data)},t.prototype.getVectorImageById=function(t){return this._assetManager.peekLiveAssetById(t,"vector-image")},t}();e.AssetAccessor=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AssetManager=void 0;var r=i(125),o=i(1),n=i(18),s=function(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1};function a(t){var e=/([^\*\\\?]*)(\\\*|\\\?|\?|\*(?!\*)|\*\*\/|$)/g,i={"":"","\\*":"\\*","\\?":"\\?","*":"[^/]*","?":"[^/]","**/":"(?:^/)?(?:[^/]+/)*"},r=/[\\^$.*+?()[\]{}|]/g;for(var o="",n=e.exec(t);n&&""!==n[0];n=e.exec(t))o+=n[1].replace(r,"\\$&")+i[n[2]];var s=new RegExp("^"+o+"$");return function(t){return s.test(t)}}var h=function(){function t(t,e,i,r){this._resourceFactory=t.resourceFactory,this._audioSystemManager=t.audio,this._defaultAudioSystemId=t.defaultAudioSystemId,this.configuration=this._normalize(e||{},function(t){void 0===t&&(t={});var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}(i)),this._assets={},this._virtualPathToIdTable={},this._liveAssetVirtualPathTable={},this._liveAssetPathTable={},this._moduleMainScripts=r||{},this._refCounts={},this._loadings={};for(var o=Object.keys(this.configuration),n=0;n<o.length;++n){var s=o[n],a=this.configuration[s];this._virtualPathToIdTable[a.virtualPath]=s}}return t.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAssetPathTable=void 0,this._refCounts=void 0,this._loadings=void 0},t.prototype.destroyed=function(){return void 0===this._assets},t.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw o.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var i=this._loadings[e.id];if(i.errorCount>t.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw o.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}i.loading||(i.loading=!0,e._load(this))},t.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},t.prototype.resolvePatternsToAssetIds=function(t){if(0===t.length)return[];for(var e=Object.keys(this._virtualPathToIdTable),i=[],r=0;r<t.length;++r)for(var o=t[r],n="string"==typeof o?a(this._replaceModulePathToAbsolute(o)):o,s=0;s<e.length;++s){var h=e[s];n("/"+h)&&i.push(this._virtualPathToIdTable[h])}return i},t.prototype.requestAsset=function(t,e){var i,r="string"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(r))++this._refCounts[r],e._onAssetLoad(this._assets[r]);else if(this._loadings.hasOwnProperty(r))(i=this._loadings[r]).handlers.push(e),++this._refCounts[r],o=!0;else{var n=this._createAssetFor(t);i=new s(n,e),this._loadings[r]=i,this._refCounts[r]=1,o=!0,i.loading=!0,n._load(this)}return o},t.prototype.unrefAsset=function(t){var e="string"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},t.prototype.requestAssets=function(t,e){for(var i=0,r=0,o=t.length;r<o;++r)this.requestAsset(t[r],e)&&++i;return i},t.prototype.unrefAssets=function(t){for(var e=0,i=t.length;e<i;++e)this.unrefAsset(t[e])},t.prototype.peekLiveAssetByAccessorPath=function(t,e){if("/"!==(t=this._replaceModulePathToAbsolute(t))[0])throw o.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): accessorPath must start with '/'");var i=t.slice(1),r=this._liveAssetVirtualPathTable[i];if(!r||e!==r.type)throw o.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): No "+e+" asset for "+t);return r},t.prototype.peekLiveAssetById=function(t,e){var i=this._assets[t];if(!i||e!==i.type)throw o.ExceptionFactory.createAssertionError("SceneAssetManager#_getById(): No "+e+" asset for id "+t);return i},t.prototype.peekAllLiveAssetsByPattern=function(t,e){for(var i=Object.keys(this._liveAssetVirtualPathTable),r="string"==typeof t?a(this._replaceModulePathToAbsolute(t)):t,o=[],n=0;n<i.length;++n){var s=i[n],h=this._liveAssetVirtualPathTable[s];if(!e||h.type===e)r("/"+s)&&o.push(h)}return o},t.prototype._normalize=function(t,e){var i={};if(!(t instanceof Object))throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(var r in t)if(t.hasOwnProperty(r)){var n=Object.create(t[r]);if(!n.path)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+r);if(!n.virtualPath)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+r);if(!n.type)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+r);if("image"===n.type){if("number"!=typeof n.width)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+r);if("number"!=typeof n.height)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+r)}if("audio"===n.type){void 0===n.duration&&(n.duration=0);var s=e[n.systemId];if(void 0===n.loop&&(n.loop=!!s&&!!s.loop),void 0===n.hint&&(n.hint=s?s.hint:{}),"music"!==n.systemId&&"sound"!==n.systemId)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong systemId given for the audio asset: "+r)}if("video"===n.type&&!n.useRealSize){if("number"!=typeof n.width)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+r);if("number"!=typeof n.height)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+r);n.useRealSize=!1}if("vector-image"===n.type){if("number"!=typeof n.width)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the vector-image asset: "+r);if("number"!=typeof n.height)throw o.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the vector-image asset: "+r)}n.global||(n.global=!1),i[r]=n}return i},t.prototype._createAssetFor=function(t){var e,i,s;if("string"==typeof t)e=t,s=this.configuration[e],i=this.configuration[e].path;else{var a=t;e=a.id,s=a,i=a.uri}var h=this._resourceFactory;if(!s)throw o.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+e);switch(s.type){case"image":var u=h.createImageAsset(e,i,s.width,s.height);return u.initialize(s.hint),u;case"audio":var c=s.systemId?this._audioSystemManager[s.systemId]:this._audioSystemManager[this._defaultAudioSystemId];return h.createAudioAsset(e,i,s.duration,c,!!s.loop,s.hint);case"text":return h.createTextAsset(e,i);case"script":return h.createScriptAsset(e,i);case"video":var l=new n.VideoSystem;return h.createVideoAsset(e,i,s.width,s.height,l,!!s.loop,!!s.useRealSize);case"vector-image":return h.createVectorImageAsset?h.createVectorImageAsset(e,i,s.width,s.height,s.hint):new r.EmptyVectorImageAsset(e,i,s.width,s.height,s.hint);default:throw o.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+s.type+" for asset ID: "+e)}},t.prototype._releaseAsset=function(t){var e=this._assets[t]||this._loadings[t]&&this._loadings[t].asset,i=null;if(e)if(i=e.path,e.inUse())if("audio"===e.type)e._system.requestDestroy(e);else{if("video"!==e.type)throw o.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+e.id);e.destroy()}else e.destroy();if(delete this._refCounts[t],delete this._loadings[t],delete this._assets[t],this.configuration[t]){var r=this.configuration[t].virtualPath;r&&this._liveAssetVirtualPathTable.hasOwnProperty(r)&&delete this._liveAssetVirtualPathTable[r],i&&this._liveAssetPathTable.hasOwnProperty(i)&&delete this._liveAssetPathTable[i]}},t.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},t.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var r=this._loadings[e.id],n=r.handlers;r.loading=!1,++r.errorCount,r.errorCount>t.MAX_ERROR_COUNT&&i.retriable&&(i=o.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,null,i)),i.retriable||delete this._loadings[e.id];for(var s=0;s<n.length;++s)n[s]._onAssetError(e,i,this.retryLoad.bind(this))}},t.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!t.destroyed()){var e=this._loadings[t.id];if(e.loading=!1,delete this._loadings[t.id],this._assets[t.id]=t,this.configuration[t.id]){var i=this.configuration[t.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(i)){if(this._liveAssetVirtualPathTable[i].path!==t.path)throw o.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[i]=t;this._liveAssetPathTable.hasOwnProperty(t.path)||(this._liveAssetPathTable[t.path]=i)}for(var r=e.handlers,n=0;n<r.length;++n)r[n]._onAssetLoad(t)}},t.prototype._replaceModulePathToAbsolute=function(t){if("/"===t[0]||"*"===t[0])return t;for(var e in this._moduleMainScripts)if(this._moduleMainScripts.hasOwnProperty(e)&&0===t.lastIndexOf(e,0))return"/node_modules/"+t;return t},t.MAX_ERROR_COUNT=3,t}();e.AssetManager=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AudioSystemManager=void 0;var r=i(15),o=function(){function t(t){this._muted=!1,this._initializeAudioSystems(t)}return t.prototype._reset=function(){this._muted=!1,this.music._reset(),this.sound._reset()},t.prototype._setMuted=function(t){this._muted!==t&&(this._muted=t,this.music._setMuted(t),this.sound._setMuted(t))},t.prototype._setPlaybackRate=function(t){this.music._setPlaybackRate(t),this.sound._setPlaybackRate(t)},t.prototype._initializeAudioSystems=function(t){this.music=new r.MusicAudioSystem({id:"music",muted:this._muted,resourceFactory:t}),this.sound=new r.SoundAudioSystem({id:"sound",muted:this._muted,resourceFactory:t})},t.prototype.stopAll=function(){this.music.stopAll(),this.sound.stopAll()},t}();e.AudioSystemManager=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.BitmapFont=void 0;var n=i(22),s=i(7),a=function(t){function e(e){var i=t.call(this)||this;return i.surface=s.SurfaceUtil.asSurface(e.src),e.glyphInfo?(i.map=e.glyphInfo.map,i.defaultGlyphWidth=e.glyphInfo.width,i.defaultGlyphHeight=e.glyphInfo.height,i.missingGlyph=e.glyphInfo.missingGlyph,i.size=e.glyphInfo.height):(i.map=e.map||{},i.defaultGlyphWidth=e.defaultGlyphWidth||0,i.defaultGlyphHeight=e.defaultGlyphHeight||0,i.missingGlyph=e.missingGlyph,i.size=e.defaultGlyphHeight||0),i}return o(e,t),e.prototype.glyphForCharacter=function(t){var e=this.map[t]||this.missingGlyph;if(!e)return null;var i=void 0===e.width?this.defaultGlyphWidth:e.width,r=void 0===e.height?this.defaultGlyphHeight:e.height,o=e.offsetX||0,n=e.offsetY||0,s=void 0===e.advanceWidth?i:e.advanceWidth,a=0===i||0===r?void 0:this.surface;return{code:t,x:e.x,y:e.y,width:i,height:r,surface:a,offsetX:o,offsetY:n,advanceWidth:s,isSurfaceValid:!0,_atlas:null}},e.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},e.prototype.destroyed=function(){return!this.map},e}(n.Font);e.BitmapFont=a},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Camera2D=void 0;var n=function(t){function e(e){var i=t.call(this,e)||this;return i.local=!!e.local,i.name=e.name,i._modifiedCount=0,i}return o(e,t),e.deserialize=function(t){return new e(t.param)},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0)},e.prototype.serialize=function(){return{param:{local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,anchorX:this.anchorX,anchorY:this.anchorY,compositeOperation:this.compositeOperation}}},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){this._matrix&&(this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(-this.x,-this.y))},e}(i(12).Object2D);e.Camera2D=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultLoadingScene=void 0;var n=i(3),s=i(33),a=i(23),h=i(12),u=function(t){function e(e){var i=t.call(this,e)||this;return i._canceller=new h.Object2D,i}return o(e,t),e.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var o=this.children,n=0;n<o.length;++n)o[n].render(t,e);return e&&t.restore(),!1},e}(n.E),c=function(t){function e(e){var i=t.call(this,{game:e.game,name:"akashic:default-loading-scene"})||this;return"compact"===e.style?(i._barWidth=i.game.width/4,i._barHeight=5,i._style="compact"):(i._barWidth=Math.min(i.game.width,Math.max(100,i.game.width/2)),i._barHeight=5,i._style="default"),i._gauge=void 0,i._gaugeUpdateCount=0,i._totalWaitingAssetCount=0,i.onLoad.add(i._handleLoad,i),i.onTargetReset.add(i._handleTargetReset,i),i.onTargetAssetLoad.add(i._handleTargetAssetLoad,i),i}return o(e,t),e.prototype._handleLoad=function(){var t,e,i,r;if("compact"===this._style){var o=.05*Math.min(this.game.width,this.game.height);t=this.game.width-o-this._barWidth,e=this.game.height-o-this._barHeight,i="transparent"}else t=(this.game.width-this._barWidth)/2,e=(this.game.height-this._barHeight)/2,i="rgba(0, 0, 0, 0.8)";return this.append(new u({scene:this,children:[new s.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:i,children:[new s.FilledRect({scene:this,x:t,y:e,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[r=new s.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),r.onUpdate.add(this._handleUpdate,this),this._gauge=r,!0},e.prototype._handleUpdate=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},e.prototype._handleTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},e.prototype._handleTargetAssetLoad=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},e}(a.LoadingScene);e.DefaultLoadingScene=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimerManager=e.TimerIdentifier=void 0;var r=i(1),o=i(42),n=function(){function t(t,e,i,r,o){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=o,this._timer.onElapse.add(this._handleElapse,this)}return t.prototype.destroy=function(){this._timer.onElapse.remove(this._handleElapse,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._handleElapse=function(){this.destroyed()||(this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this))},t}();e.TimerIdentifier=n;var s=function(){function t(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return t.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},t.prototype.destroyed=function(){return void 0===this._timers},t.prototype.createTimer=function(t){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),t<0)throw r.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");t<1&&(t=1);for(var e=Math.min(1e3,t*this._fps),i=0;i<this._timers.length;++i)if(this._timers[i].interval===t&&this._timers[i]._scaledElapsed<e)return this._timers[i];var n=new o.Timer(t,this._fps);return this._timers.push(n),n},t.prototype.deleteTimer=function(t){if(t.canDelete()){var e=this._timers.indexOf(t);if(e<0)throw r.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(e,1),t.destroy(),!this._timers.length){if(!this._registered)throw r.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},t.prototype.setTimeout=function(t,e,i){var r=this.createTimer(e),o=new n(r,t,i,this._onTimeoutFired,this);return this._identifiers.push(o),o},t.prototype.clearTimeout=function(t){this._clear(t)},t.prototype.setInterval=function(t,e,i){var r=this.createTimer(e),o=new n(r,t,i);return this._identifiers.push(o),o},t.prototype.clearInterval=function(t){this._clear(t)},t.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},t.prototype._onTimeoutFired=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw r.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(e,1);var i=t._timer;t.destroy(),this.deleteTimer(i)},t.prototype._clear=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw r.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(t.destroyed())throw r.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(e,1);var i=t._timer;t.destroy(),this.deleteTimer(i)},t}();e.TimerManager=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Timer=void 0;var r=i(0),o=function(){function t(t,e){this.interval=t,this._scaledInterval=Math.round(t*e),this.onElapse=new r.Trigger,this.elapsed=this.onElapse,this._scaledElapsed=0}return t.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.onElapse;)this.onElapse.fire(),this._scaledElapsed-=this._scaledInterval},t.prototype.canDelete=function(){return!this.onElapse||0===this.onElapse.length},t.prototype.destroy=function(){this.interval=void 0,this.onElapse.destroy(),this.onElapse=void 0,this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},t.prototype.destroyed=function(){return void 0===this.onElapse},t}();e.Timer=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurfaceAtlas=void 0;var r=i(44);var o=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new r.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype.reset=function(){var t=this._surface.renderer();t.begin(),t.clear(),t.end(),this._emptySurfaceAtlasSlotHead=new r.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize.width=0,this._usedRectangleAreaSize.height=0},t.prototype._acquireSurfaceAtlasSlot=function(t,e){t+=1,e+=1;var i=function(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}(this._emptySurfaceAtlasSlotHead,t,e);if(!i)return null;var o,n,s=i.width-t,a=i.height-e;s<=a?(o=new r.SurfaceAtlasSlot(i.x+t,i.y,s,e),n=new r.SurfaceAtlasSlot(i.x,i.y+e,i.width,a)):(o=new r.SurfaceAtlasSlot(i.x,i.y+e,t,a),n=new r.SurfaceAtlasSlot(i.x+t,i.y,s,i.height)),o.prev=i.prev,o.next=n,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,n.prev=o,n.next=i.next,n.next&&(n.next.prev=n);var h=new r.SurfaceAtlasSlot(i.x,i.y,t,e);return this._updateUsedRectangleAreaSize(h),h},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t,e,i,r,o){var n=this._acquireSurfaceAtlasSlot(r,o);if(!n)return null;var s=this._surface.renderer();return s.begin(),s.drawImage(t,e,i,r,o,n.x,n.y),s.end(),n},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.getAtlasUsedSize=function(){return this._usedRectangleAreaSize},t.prototype.getAccessScore=function(){return this._accessScore},t}();e.SurfaceAtlas=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurfaceAtlasSlot=void 0;var r=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null};e.SurfaceAtlasSlot=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventConverter=void 0;var r=i(3),o=i(20),n=i(1),s=i(26),a=function(){function t(t){var e;this._game=t.game,this._playerId=null!==(e=t.playerId)&&void 0!==e?e:null,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,i,a,h,u,c,l,d,p=t[0],f=t[1],_=t[2],y=this._playerTable[_]||{id:_};switch(p){case 0:y={id:_,name:t[3]},this._playerTable[_]&&null!=this._playerTable[_].userData&&(y.userData=this._playerTable[_].userData),this._playerTable[_]=y;var v=void 0;if(t[4]){var g=[],m=[];t[4].map((function(t){g.push(t.readKey),m.push(t.values)})),v=new s.StorageValueStore(g,m)}return new o.JoinEvent(y,v,f);case 1:return delete this._playerTable[y.id],new o.LeaveEvent(y,f);case 2:return d=t[3],new o.TimestampEvent(d,y,f);case 3:return y={id:_,name:t[3],userData:t[4]},this._playerTable[_]=y,new o.PlayerInfoEvent(y,f);case 32:return l=t[4],new o.MessageEvent(t[3],y,l,f);case 33:return l=t[7],e=t[3],a=null==(i=t[6])?void 0:i>=0?this._game.db[i]:this._game._localDb[i],h={x:t[4],y:t[5]},new r.PointDownEvent(e,a,h,y,l,f);case 34:return l=t[11],e=t[3],a=null==(i=t[10])?void 0:i>=0?this._game.db[i]:this._game._localDb[i],h={x:t[4],y:t[5]},u={x:t[6],y:t[7]},c={x:t[8],y:t[9]},new r.PointMoveEvent(e,a,h,c,u,y,l,f);case 35:return l=t[11],e=t[3],a=null==(i=t[10])?void 0:i>=0?this._game.db[i]:this._game._localDb[i],h={x:t[4],y:t[5]},u={x:t[6],y:t[7]},c={x:t[8],y:t[9]},new r.PointUpEvent(e,a,h,c,u,y,l,f);case 64:l=t[5];var A=t[3],x=t[4],P=this._game._decodeOperationPluginOperation(A,x);return new o.OperationEvent(A,P,y,l,f);default:throw n.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},t.prototype.toPlaylogEvent=function(t,e){var i,r,o,s,a,h,u,c,l;switch(t.type){case"join":case"leave":throw n.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+t.type);case"timestamp":var d=t;return l=e?null!==(i=d.player.id)&&void 0!==i?i:null:this._playerId,[2,d.eventFlags,l,d.timestamp];case"player-info":var p=t;return l=e?null!==(r=p.player.id)&&void 0!==r?r:null:this._playerId,[3,p.eventFlags,l,p.player.name,p.player.userData];case"point-down":var f=t;return c=f.target?f.target.id:null,l=e&&f.player?null!==(o=f.player.id)&&void 0!==o?o:null:this._playerId,[33,f.eventFlags,l,f.pointerId,f.point.x,f.point.y,c,!!f.local];case"point-move":var _=t;return c=_.target?_.target.id:null,l=e&&_.player?null!==(s=_.player.id)&&void 0!==s?s:null:this._playerId,[34,_.eventFlags,l,_.pointerId,_.point.x,_.point.y,_.startDelta.x,_.startDelta.y,_.prevDelta.x,_.prevDelta.y,c,!!_.local];case"point-up":var y=t;return c=y.target?y.target.id:null,l=e&&y.player?null!==(a=y.player.id)&&void 0!==a?a:null:this._playerId,[35,y.eventFlags,l,y.pointerId,y.point.x,y.point.y,y.startDelta.x,y.startDelta.y,y.prevDelta.x,y.prevDelta.y,c,!!y.local];case"message":var v=t;return l=e&&v.player?null!==(h=v.player.id)&&void 0!==h?h:null:this._playerId,[32,v.eventFlags,l,v.data,!!v.local];case"operation":var g=t;return l=e&&g.player?null!==(u=g.player.id)&&void 0!==u?u:null:this._playerId,[64,g.eventFlags,l,g.code,g.data,!!g.local];default:throw n.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._playerId;return[64,null!=t.priority?3&t.priority:0,e,t._code,t.data,!!t.local]},t}();e.EventConverter=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ModuleManager=void 0;var r=i(1),o=i(16),n=i(17),s=i(47),a=i(48),h=function(){function t(t,e){this._assetManager=e,this._runtimeValueBase=t,this._scriptCaches={}}return t.prototype._require=function(t,e){var i,h,u=this,c=this._assetManager._liveAssetVirtualPathTable,l=this._assetManager._moduleMainScripts;if(-1===t.indexOf("/")&&this._assetManager._assets.hasOwnProperty(t)&&(i=this._assetManager._assets[t],h=this._assetManager._liveAssetPathTable[i.path]),/^\.\/|^\.\.\/|^\//.test(t)){if(e){if(!e._virtualDirname)throw r.ExceptionFactory.createAssertionError("g._require: require from modules without virtualPath is not supported");h=n.PathUtil.resolvePath(e._virtualDirname,t)}else{if(!/^\.\//.test(t))throw r.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");h=t.substring(2)}if(this._scriptCaches.hasOwnProperty(h))return this._scriptCaches[h]._cachedValue();if(this._scriptCaches.hasOwnProperty(h+".js"))return this._scriptCaches[h+".js"]._cachedValue();i||(i=this._findAssetByPathAsFile(h,c)),i||(i=this._findAssetByPathAsDirectory(h,c))}else if(l[t]&&(i=c[h=l[t]]),!i){var d=e?e.paths:[];d.push("node_modules");for(var p=0;p<d.length;++p){var f=d[p];if(h=n.PathUtil.resolvePath(f,t),i=this._findAssetByPathAsFile(h,c))break;if(i=this._findAssetByPathAsDirectory(h,c))break}}if(i){if(this._scriptCaches.hasOwnProperty(h))return this._scriptCaches[h]._cachedValue();if("script"===i.type){var _=new o.Module({runtimeValueBase:this._runtimeValueBase,id:i.id,path:i.path,virtualPath:this._assetManager._liveAssetPathTable[i.path],requireFunc:function(t,e){return u._require(t,e)},resolveFunc:function(t,e){return u._resolvePath(t,e)}}),y=new a.ScriptAssetContext(i,_);return this._scriptCaches[h]=y,y._executeScript(e)}if("text"===i.type&&i&&".json"===n.PathUtil.resolveExtname(t))return(this._scriptCaches[h]=new s.RequireCachedValue(JSON.parse(i.data)))._cachedValue()}throw r.ExceptionFactory.createAssertionError("g._require: can not find module: "+t)},t.prototype._resolvePath=function(t,e){var i=null,o=this._assetManager._liveAssetVirtualPathTable,s=this._assetManager._moduleMainScripts;if(/^\.\/|^\.\.\/|^\//.test(t)){if(!e)throw r.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the moudle without currentModule");if(!e._virtualDirname)throw r.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the moudle path without virtualPath");if(i=n.PathUtil.resolvePath(e._virtualDirname,t),c=this._resolveAbsolutePathAsFile(i,o))return c;if(c=this._resolveAbsolutePathAsDirectory(i,o))return c}else{if(s[t])return s[t];var a=e?e.paths.concat():[];a.push("node_modules");for(var h=0;h<a.length;++h){var u=a[h],c=n.PathUtil.resolvePath(u,t);if(i=this._resolveAbsolutePathAsFile(c,o))return i;if(i=this._resolveAbsolutePathAsDirectory(c,o))return i}}throw r.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the path: "+t)},t.prototype._findAssetByPathAsFile=function(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0},t.prototype._findAssetByPathAsDirectory=function(t,e){var i;if(i=t+"/package.json",e.hasOwnProperty(i)&&"text"===e[i].type){var r=JSON.parse(e[i].data);if(r&&"string"==typeof r.main){var o=this._findAssetByPathAsFile(n.PathUtil.resolvePath(t,r.main),e);if(o)return o}}if(i=t+"/index.js",e.hasOwnProperty(i))return e[i]},t.prototype._resolveAbsolutePathAsFile=function(t,e){return e.hasOwnProperty(t)?"/"+t:e.hasOwnProperty(t+".js")?"/"+t+".js":null},t.prototype._resolveAbsolutePathAsDirectory=function(t,e){var i=t+"/package.json";if(e.hasOwnProperty(i)&&"text"===e[i].type){var r=JSON.parse(e[i].data);if(r&&"string"==typeof r.main){var o=this._resolveAbsolutePathAsFile(n.PathUtil.resolvePath(t,r.main),e);if(o)return"/"+o}}return i=t+"/index.js",e.hasOwnProperty(i)?"/"+i:null},t}();e.ModuleManager=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RequireCachedValue=void 0;var r=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();e.RequireCachedValue=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScriptAssetContext=void 0;var r=i(1),o=function(){function t(t,e){this._asset=t,this._module=e,this._started=!1}return t.prototype._cachedValue=function(){if(!this._started)throw r.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},t.prototype._executeScript=function(t){return this._started||(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._module._runtimeValue),this._module.loaded=!0),this._module.exports},t}();e.ScriptAssetContext=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OperationPluginManager=void 0;var r=i(0),o=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t)._code=this._code,this._handler.call(this._handlerOwner,e)},t}(),n=function(){function t(t,e,i){this.onOperate=new r.Trigger,this.operated=this.onOperate,this.plugins={},this._game=t,this._viewInfo=e,this._infos=i,this._initialized=!1}return t.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},t.prototype.register=function(t,e,i){this._infos[e]={code:e,_plugin:this._instantiateOperationPlugin(t,e,i)}},t.prototype.start=function(t){var e=this._infos[t];e&&e._plugin&&e._plugin.start()},t.prototype.stop=function(t){var e=this._infos[t];e&&e._plugin&&e._plugin.stop()},t.prototype.destroy=function(){this.stopAll(),this.onOperate.destroy(),this.onOperate=void 0,this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},t.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},t.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},t.prototype._loadOperationPlugins=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];if(e.script){var i=this._game._moduleManager._require(e.script);e._plugin=this._instantiateOperationPlugin(i,e.code,e.option)}}},t.prototype._instantiateOperationPlugin=function(t,e,i){if(t.isSupported()){if(this.plugins[e])throw new Error("Plugin#code conflicted for code: "+e);if(this._infos[e])throw new Error("this plugin (code: "+e+") is already defined in game.json");var r=new t(this._game,this._viewInfo,i);this.plugins[e]=r;var n=new o(e,this.onOperate,this.onOperate.fire);return r.operationTrigger.add(n.onOperation,n),r}},t}();e.OperationPluginManager=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointEventResolver=void 0;var r=function(){function t(t){this._pointEventMap={},this._sourceResolver=t.sourceResolver,this._playerId=t.playerId}return t.prototype.pointDown=function(t){var e=this._sourceResolver.findPointSource(t.offset),i=e.point?e.point:t.offset,r=e.target?e.target.id:void 0,o=e.local;this._pointEventMap[t.identifier]={targetId:r,local:o,point:i,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var n=[33,2,this._playerId,t.identifier,i.x,i.y,r];return e&&e.local&&n.push(e.local),n},t.prototype.pointMove=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var i={x:0,y:0},r={x:0,y:0};this._pointMoveAndUp(e,t.offset,i,r);var o=[34,2,this._playerId,t.identifier,e.point.x,e.point.y,r.x,r.y,i.x,i.y,e.targetId];return e.local&&o.push(e.local),o},t.prototype.pointUp=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var i={x:0,y:0},r={x:0,y:0};this._pointMoveAndUp(e,t.offset,i,r),delete this._pointEventMap[t.identifier];var o=[35,2,this._playerId,t.identifier,e.point.x,e.point.y,r.x,r.y,i.x,i.y,e.targetId];return e.local&&o.push(e.local),o},t.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();e.PointEventResolver=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RandomGenerator=void 0;var r=function(t){this.seed=t};e.RandomGenerator=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Xorshift=void 0;var r=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){t=1812433253*(t^t>>30)+1,this._state0U=t,t=1812433253*(t^t>>30)+2,this._state0L=t,t=1812433253*(t^t>>30)+3,this._state1U=t,t=1812433253*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var o=0,n=0;o=(t^=o=t<<23|(-512&e)>>>9)^i,n=(e^=n=e<<23)^r;o^=t>>>17,n^=e>>>17|(131071&t)<<15;o^=i>>>26,n^=r>>>26|(67108863&i)<<6,this._state1U=o,this._state1L=n;var s=(n>>>0)+(r>>>0);return[o+i+(s/2>>>31)>>>0,s>>>0]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();e.Xorshift=r},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.XorshiftRandomGenerator=void 0;var n=i(1),s=i(51),a=i(52),h=function(t){function e(e,i){var r=this;if(void 0===e)throw n.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return(r=t.call(this,e)||this)._xorshift=i?a.Xorshift.deserialize(i):new a.Xorshift(e),r}return o(e,t),e.deserialize=function(t){return new e(t._seed,t._xorshift)},e.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},e.prototype.generate=function(){return this._xorshift.random()},e.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},e}(s.RandomGenerator);e.XorshiftRandomGenerator=h},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLImageAsset=e.ImageAssetSurface=void 0;var n=i(8),s=i(5),a=i(6),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.renderer=function(){throw new Error("ImageAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(n.Surface);e.ImageAssetSurface=h;var u=function(t){function e(e,i,r,o){var n=t.call(this,e,i)||this;return n.type="image",n.width=r,n.height=o,n.data=void 0,n._surface=void 0,n}return o(e,t),e.prototype.initialize=function(t){this.hint=t},e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,s.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw new Error("ImageAssetImpl#asSurface: not yet loaded.");return this._surface||(this._surface=new h(this.width,this.height,this.data)),this._surface},e}(a.Asset);e.HTMLImageAsset=u},function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),o(i(2),e),o(i(159),e),o(i(160),e),o(i(56),e),o(i(161),e),o(i(162),e),o(i(163),e),o(i(164),e),o(i(165),e),o(i(166),e),o(i(167),e),o(i(168),e),o(i(169),e),o(i(170),e),o(i(171),e),o(i(172),e)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExceptionFactory=void 0,function(t){t.createAssertionError=function(t,e){var i=new Error(t);return i.name="AssertionError",i.cause=e,i},t.createTypeMismatchError=function(t,e,i,r){var o="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var n;o+=", actual type is "+((n=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i).length>40?n.substr(0,40):n)}catch(t){}o+=".";var s=new Error(o);return s.name="TypeMismatchError",s.cause=r,s.expected=e,s.actual=i,s},t.createAssetLoadError=function(t,e,i,r){void 0===e&&(e=!0),void 0===i&&(i=null);var o=new Error(t);return o.name="AssetLoadError",o.cause=r,o.retriable=e,o}}(e.ExceptionFactory||(e.ExceptionFactory={}))},function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Asset=void 0;var s=n(i(10)),a=function(){function t(t,e){this.type="",this.onDestroyed=new s.Trigger,this.id=t,this.path=e,this.originalPath=e}return t.prototype.inUse=function(){return!1},t.prototype.destroy=function(){this.onDestroyed.destroy(),this.onDestroyed=void 0},t.prototype.destroyed=function(){return void 0===this.onDestroyed},t.prototype._assetPathFilter=function(t){return t},t}();e.Asset=a},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.SVGImageAsset=e.SVGImageAssetSurface=void 0;var n=i(13),s=i(8),a=i(5),h=i(6),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.renderer=function(){throw new Error("SVGImageAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(s.Surface);e.SVGImageAssetSurface=u;var c=function(t){function e(e,i,r,o,n){var s=t.call(this,e,i)||this;return s.type="vector-image",s.width=r,s.height=o,s.hint=n,s.data=null,s._surface=null,s}return o(e,t),e.prototype.destroy=function(){this.data=null,this.hint=void 0,this._surface=null,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,a.ExceptionFactory.createAssetLoadError("SVGImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.createSurface=function(t,e,i,r,o,s){void 0===i&&(i=0),void 0===r&&(r=0);var a=this.width,h=this.height,c=this.data;if(!c)throw new Error("SVGImageAsset#asSurface: not yet loaded.");this._surface||(this._surface=new u(a,h,c)),o||(o=a),s||(s=h);var l=new n.Context2DSurface(t,e),d=l.renderer();return d.save(),d.transform([t/o,0,0,e/s,0,0]),d.drawImage(this._surface,i,r,o,s,0,0),d.restore(),l},e}(h.Asset);e.SVGImageAsset=c},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasSurface=void 0;var n=function(t){function e(e,i){var r=this,o=document.createElement("canvas");return r=t.call(this,e,i,o)||this,o.width=e,o.height=i,r.canvas=o,r}return o(e,t),e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,t.prototype.destroy.call(this)},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;"transform"in i?(i.transformOrigin="0 0",i.transform="scale("+t+","+e+")"):"webkitTransform"in i?(i.webkitTransformOrigin="0 0",i.webkitTransform="scale("+t+","+e+")"):(i.width=Math.floor(t*this.width)+"px",i.height=Math.floor(e*this.width)+"px")},e}(i(8).Surface);e.CanvasSurface=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasSurfaceContext=void 0;var r=i(174),o=function(){function t(t){this._stateStack=[],this._modifiedTransform=!1,this._context=t;var e=new r.CanvasRenderingState;this._contextFillStyle=e.fillStyle,this._contextGlobalAlpha=e.globalAlpha,this._contextGlobalCompositeOperation=e.globalCompositeOperation,this.pushState(e)}return Object.defineProperty(t.prototype,"fillStyle",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalAlpha",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalCompositeOperation",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!1,configurable:!0}),t.prototype.getCanvasRenderingContext2D=function(){return this._context},t.prototype.clearRect=function(t,e,i,r){this.prerender(),this._context.clearRect(t,e,i,r)},t.prototype.save=function(){var t=new r.CanvasRenderingState(this.currentState());this.pushState(t)},t.prototype.restore=function(){this.popState()},t.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},t.prototype.drawImage=function(t,e,i,r,o,n,s,a,h){this.prerender(),this._context.drawImage(t,e,i,r,o,n,s,a,h)},t.prototype.fillRect=function(t,e,i,r){this.prerender(),this._context.fillRect(t,e,i,r)},t.prototype.fillText=function(t,e,i,r){this.prerender(),this._context.fillText(t,e,i,r)},t.prototype.strokeText=function(t,e,i,r){this.prerender(),this._context.strokeText(t,e,i,r)},t.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},t.prototype.transform=function(t,e,i,r,o,n){this.currentState().transformer.transform([t,e,i,r,o,n]),this._modifiedTransform=!0},t.prototype.setTransform=function(t,e,i,r,o,n){this.currentState().transformer.setTransform([t,e,i,r,o,n]),this._modifiedTransform=!0},t.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},t.prototype.getImageData=function(t,e,i,r){return this._context.getImageData(t,e,i,r)},t.prototype.putImageData=function(t,e,i,r,o,n,s){this._context.putImageData(t,e,i,r,o,n,s)},t.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._contextFillStyle&&(this._context.fillStyle=t.fillStyle,this._contextFillStyle=t.fillStyle),t.globalAlpha!==this._contextGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._contextGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._contextGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._contextGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},t.prototype.pushState=function(t){this._stateStack.push(t)},t.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0,this._contextFillStyle=this._context.fillStyle,this._contextGlobalAlpha=this._context.globalAlpha,this._contextGlobalCompositeOperation=this._context.globalCompositeOperation)},t.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},t}();e.CanvasSurfaceContext=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AffineTransformer=void 0;var r=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},t.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],o=t[2]*e[0]+t[3]*e[2],n=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=o,e[3]=n,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();e.AffineTransformer=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context2DRenderer=void 0;var r={"source-over":"source-over","source-atop":"source-atop",lighter:"lighter",copy:"copy","experimental-source-in":"source-in","experimental-source-out":"source-out","experimental-destination-atop":"destination-atop","experimental-destination-in":"destination-in","destination-out":"destination-out","destination-over":"destination-over",xor:"xor"},o=function(){function t(t){this.surface=t,this.context=t.context(),this.canvasRenderingContext2D=this.context.getCanvasRenderingContext2D()}return t.prototype.begin=function(){this.canvasRenderingContext2D.save(),this.context.save()},t.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore()},t.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},t.prototype.drawImage=function(t,e,i,r,o,n,s){this.context.drawImage(t._drawable,e,i,r,o,n,s,r,o)},t.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},t.prototype.translate=function(t,e){this.context.translate(t,e)},t.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},t.prototype.opacity=function(t){this.context.globalAlpha*=t},t.prototype.save=function(){this.context.save()},t.prototype.restore=function(){this.context.restore()},t.prototype.fillRect=function(t,e,i,r,o){this.context.fillStyle=o,this.context.fillRect(t,e,i,r)},t.prototype.setCompositeOperation=function(t){this.context.globalCompositeOperation=r[t]||"source-over"},t.prototype.setOpacity=function(t){this.context.globalAlpha=t},t.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},t.prototype.setShaderProgram=function(t){throw new Error("Context2DRenderer#setShaderProgram() is not implemented")},t.prototype.isSupportedShaderProgram=function(){return!1},t.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},t.prototype._putImageData=function(t,e,i,r,o,n,s){void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,o,n,s)},t}();e.Context2DRenderer=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLVideoAsset=void 0;var n=i(8),s=i(6),a=i(177),h=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return o(e,t),e.prototype.renderer=function(){throw new Error("VideoAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(n.Surface),u=function(t){function e(e,i,r,o,n,s,u){var c=t.call(this,e,i)||this;return c.type="video",c.width=r,c.height=o,c.realWidth=0,c.realHeight=0,c._system=n,c._loop=s,c._useRealSize=u,c._player=new a.HTMLVideoPlayer,c._surface=new h(r,o,null),c}return o(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout((function(){t._onAssetLoad(e)}),0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(s.Asset);e.HTMLVideoAsset=u},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.XHRTextAsset=void 0;var n=i(9),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="text",r}return o(e,t),e.prototype._load=function(t){var e=this;(new n.XHRLoader).get(this.path,(function(i,r){i?t._onAssetError(e,i):(e.data=r,t._onAssetLoad(e))}))},e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(i(6).Asset);e.XHRTextAsset=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AudioManager=void 0;var r=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();e.AudioManager=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AudioPluginManager=void 0;var r=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];if(!r.isSupported)return this._activePlugin=r,!0;var o=r;if(o.isSupported())return this._activePlugin=new o,!0}return!1},t}();e.AudioPluginManager=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AudioPluginRegistry=void 0;var r=[];e.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ResourceFactory=void 0;var r=i(54),o=i(63),n=i(58),s=i(188),a=i(64),h=i(69),u=i(189),c=function(){function t(t){this._audioPluginManager=t.audioPluginManager,this._audioManager=t.audioManager,this._platform=t.platform,this._surfaceFactory=new u.SurfaceFactory}return t.prototype.createAudioAsset=function(t,e,i,r,o,n){var s=this._audioPluginManager.getActivePlugin().createAsset(t,e,i,r,o,n);return this._audioManager.registerAudioAsset(s),s.onDestroyed.addOnce(this._onAudioAssetDestroyed,this),s},t.prototype.createAudioPlayer=function(t){return this._audioPluginManager.getActivePlugin().createPlayer(t,this._audioManager)},t.prototype.createImageAsset=function(t,e,i,o){return new r.HTMLImageAsset(t,e,i,o)},t.prototype.createVideoAsset=function(t,e,i,r,n,s,a){return new o.HTMLVideoAsset(t,e,i,r,n,s,a)},t.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},t.prototype.createScriptAsset=function(t,e){return new s.XHRScriptAsset(t,e)},t.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},t.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},t.prototype.createGlyphFactory=function(t,e,i,r,o,n,s,a){return new h.GlyphFactory(t,e,i,r,o,n,s,a)},t.prototype.createVectorImageAsset=function(t,e,i,r,o){return new n.SVGImageAsset(t,e,i,r,o)},t.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},t}();e.ResourceFactory=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GlyphFactory=void 0;var r=i(13);function o(t,e,i,o,n,s,a,u,c,l,d,p){var f=e<h._environmentMinimumFontSize?e/h._environmentMinimumFontSize:1,_=Math.ceil((e+2*n)*f),y=Math.ceil((e+2*s)*f),v=new r.Context2DSurface(_,y),g=v.canvas,m=g.getContext("2d"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);m.save(),m.font=p+" "+e+"px "+i,m.textAlign="left",m.textBaseline="alphabetic",m.lineJoin="bevel",1!==f&&m.scale(f,f),c>0&&(m.lineWidth=c,m.strokeStyle=l,m.strokeText(A,n,s+o)),d||(m.fillStyle=u,m.fillText(A,n,s+o));var x=m.measureText(A).width;return m.restore(),{surface:v,advanceWidth:x,imageData:a?m.getImageData(0,0,g.width,g.height):void 0}}var n=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function s(t){return-1!==n.indexOf(t)?t:'"'+t+'"'}function a(t,e,i,r,o,n,s,a,h,u){return{code:t,x:e,y:i,width:r,height:o,surface:h,offsetX:n,offsetY:s,advanceWidth:a,isSurfaceValid:u,_atlas:null}}var h=function(){function t(e,i,r,o,n,a,h,u){void 0===r&&(r=i),void 0===o&&(o="black"),void 0===n&&(n=0),void 0===a&&(a="black"),void 0===h&&(h=!1),void 0===u&&(u="normal"),this._glyphAreas=Object.create(null),this.fontFamily=e,this.fontSize=i,this.baselineHeight=r,this.fontColor=o,this.strokeWidth=n,this.strokeColor=a,this.strokeOnly=h,this.fontWeight=u,this._cssFontFamily="string"==typeof e?s(e):e.map(s).join(","),-1===this._cssFontFamily.indexOf("sans-serif")&&(this._cssFontFamily+=",sans-serif"),this._marginW=Math.ceil(.3*this.fontSize+this.strokeWidth/2),this._marginH=Math.ceil(.3*this.fontSize+this.strokeWidth/2),void 0===t._environmentMinimumFontSize&&(t._environmentMinimumFontSize=this.measureMinimumFontSize())}return t.prototype.create=function(t){var e,i=this._glyphAreas[t];return i||((i=function(t){for(var e=t.width,i=t.height,r=0,o=0,n=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,u=t.width;h<u;h=h+1|0){0!==t.data[n+3]&&(h<e&&(e=h),h>r&&(r=h),s<i&&(i=s),s>o&&(o=s)),n+=4}return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:o-i+1}}((e=o(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)).imageData)).advanceWidth=e.advanceWidth,this._glyphAreas[t]=i),function(t){return 0===t.width||0===t.height}(i)?(e&&e.surface.destroy(),a(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(e||(e=o(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),a(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,e.surface,!0))},t.prototype.measureMinimumFontSize=function(){var t,e=1,i=document.createElement("canvas").getContext("2d");i.textAlign="left",i.textBaseline="alphabetic",i.lineJoin="bevel",i.font=e+"px sans-serif";var r=i.measureText("M").width;do{t=r,e+=1,i.font=e+"px sans-serif",r=i.measureText("M").width}while(t===r||e>50);return e},t}();e.GlyphFactory=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLRenderer=void 0;var r=i(193),o=i(71),n=function(){function t(e,i){this._stateStack=[],this._stateStackPointer=0,this._capacity=0,this._reallocation(t.DEFAULT_CAPACITY),this._whiteColor=[1,1,1,1],this._shared=e,this._renderTarget=i}return t.prototype.clear=function(){this._shared.clear()},t.prototype.begin=function(){},t.prototype.end=function(){this._shared.end()},t.prototype.save=function(){this._pushState()},t.prototype.restore=function(){this._popState()},t.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},t.prototype.transform=function(t){this.currentState().transformer.transform(t)},t.prototype.opacity=function(t){this.currentState().globalAlpha*=t},t.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},t.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},t.prototype.fillRect=function(t,e,i,o,n){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,o,t,e,r.WebGLColor.get(n))},t.prototype.drawSprites=function(t,e,i,r,o,n,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],i[h],r[h],o[h],n[h],s[h])},t.prototype.drawImage=function(t,e,i,r,o,n,s){if(!t._drawable)throw new Error("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw new Error("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,n,s,this._whiteColor)},t.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},t.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},t.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},t.prototype.isSupportedShaderProgram=function(){return!0},t.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},t.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},t.prototype._getImageData=function(){throw new Error("WebGLRenderer#_getImageData() is not implemented")},t.prototype._putImageData=function(t,e,i,r,o,n,s){throw new Error("WebGLRenderer#_putImageData() is not implemented")},t.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},t.prototype._popState=function(){if(!(this._stateStackPointer>0))throw new Error("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},t.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},t.prototype._reallocation=function(t){var e=this._capacity;if(e<t){t<2*e?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new o.WebGLRenderingState)}},t.DEFAULT_CAPACITY=16,t}();e.WebGLRenderer=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLRenderingState=void 0;var r=i(61),o=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new r.AffineTransformer,this.shaderProgram=null)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},t}();e.WebGLRenderingState=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLPrimarySurface=void 0;var n=i(59),s=i(194),a=function(t){function e(e,i,r){var o=t.call(this,i,r)||this;return o.canvas.style.position="absolute",o._shared=e,o}return o(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new s.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},e.prototype.changePhysicalScale=function(t,e){var i=Math.ceil(this.width*t),r=Math.ceil(this.height*e);this.canvas.width=i,this.canvas.height=r,this.renderer().changeViewportSize(i,r)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);e.WebGLPrimarySurface=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addExtname=void 0,e.addExtname=function(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)}},function(t,e,i){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&o(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.initialize=void 0;var a=s(i(10)),h=i(154),u=i(155),c=null;window.g=a,e.initialize=function(t){var e,i,o=new u.ResourceFactory({canvas:t.canvas,assetLoaderFuncs:t.assetLoaderFuncs,assetBaseDir:t.assetBaseDir});null==t.configuration.assets&&(t.configuration.assets={});for(var n=t.configuration.assets,s=Object.keys(n),l=0;l<s.length;l++)n[s[l]].virtualPath=n[s[l]].path;var d=new a.Game({engineModule:a,handlerSet:new h.GameHandlerSet({isSnapshotSaver:!0}),configuration:r(r({},t.configuration),{width:null!==(e=t.configuration.width)&&void 0!==e?e:t.canvas.width,height:null!==(i=t.configuration.height)&&void 0!==i?i:t.canvas.height}),resourceFactory:o,mainFunc:t.mainFunc}),p=o.createPrimarySurface(d.width,d.height);d.renderers.push(p.renderer()),d._reset({randSeed:Date.now()}),d._loadAndStart({});var f=[],_=t.canvas,y=function(){return _.getBoundingClientRect().width/_.clientWidth},v=function(){return _.getBoundingClientRect().height/_.clientHeight},g=function(t){var e=_.getBoundingClientRect();f.push({type:0,identifier:0,offset:{x:(t.clientX-e.left)/y(),y:(t.clientY-e.top)/v()}}),window.addEventListener("mousemove",m,{passive:!1}),window.addEventListener("mouseup",A,{passive:!1})},m=function(t){var e=_.getBoundingClientRect();f.push({type:1,identifier:0,offset:{x:(t.clientX-e.left)/y(),y:(t.clientY-e.top)/v()}}),t.stopPropagation(),t.returnValue=!1},A=function(t){var e=_.getBoundingClientRect();f.push({type:2,identifier:0,offset:{x:(t.clientX-e.left)/y(),y:(t.clientY-e.top)/v()}}),window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",A)},x=function(t){for(var e=t.changedTouches,i=_.getBoundingClientRect(),r=0;r<e.length;r++){var o=(e[r].clientX-i.left)/y(),n=(e[r].clientY-i.top)/v(),s=e[r].identifier;f.push({type:0,identifier:s,offset:{x:o,y:n}})}window.addEventListener("touchmove",P,{passive:!1}),window.addEventListener("touchend",S,{passive:!1}),t.preventDefault()},P=function(t){for(var e=t.changedTouches,i=_.getBoundingClientRect(),r=0;r<e.length;r++){var o=(e[r].clientX-i.left)/y(),n=(e[r].clientY-i.top)/v(),s=e[r].identifier;f.push({type:1,identifier:s,offset:{x:o,y:n}})}t.cancelable&&t.preventDefault()},S=function(t){for(var e=t.changedTouches,i=_.getBoundingClientRect(),r=0;r<e.length;r++){var o=(e[r].clientX-i.left)/y(),n=(e[r].clientY-i.top)/v(),s=e[r].identifier;f.push({type:2,identifier:s,offset:{x:o,y:n}})}window.removeEventListener("touchmove",P),window.removeEventListener("touchend",S)};_.addEventListener("mousedown",g,{passive:!1}),_.addEventListener("touchstart",x,{passive:!1});var b=Date.now(),w=1e3/d.fps,E=function(){if(null!==c){var t=Date.now();if(b+2*w<t&&(b=t-w-1),b+w<t){if(f.length){for(var e=[],i=0;i<f.length;i++){var r=d.resolvePointEvent(f[i]);null!=r&&e.push(r)}f.length=0,d.tick(!0,void 0,e)}else d.tick(!0);d.render(),b+=w}c=window.requestAnimationFrame(E)}};return c=window.requestAnimationFrame(E),function(){null!==c&&(window.cancelAnimationFrame(c),c=null),_.removeEventListener("mousedown",g),_.removeEventListener("touchstart",x),p.renderer().clear()}}},function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),o(i(76),e),o(i(153),e)},function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),o(i(77),e),o(i(0),e),o(i(14),e);var n=i(15);Object.defineProperty(e,"AudioSystem",{enumerable:!0,get:function(){return n.AudioSystem}});var s=i(16);Object.defineProperty(e,"Module",{enumerable:!0,get:function(){return s.Module}});var a=i(32);Object.defineProperty(e,"ShaderProgram",{enumerable:!0,get:function(){return a.ShaderProgram}});var h=i(18);Object.defineProperty(e,"VideoSystem",{enumerable:!0,get:function(){return h.VideoSystem}}),o(i(15),e),o(i(19),e),o(i(3),e),o(i(33),e),o(i(121),e),o(i(122),e),o(i(123),e),o(i(21),e),o(i(35),e),o(i(124),e),o(i(36),e),o(i(126),e),o(i(37),e),o(i(38),e),o(i(127),e),o(i(39),e),o(i(128),e),o(i(40),e),o(i(130),e),o(i(131),e),o(i(132),e),o(i(20),e),o(i(45),e),o(i(133),e),o(i(134),e),o(i(135),e),o(i(136),e),o(i(1),e),o(i(22),e),o(i(137),e),o(i(138),e),o(i(23),e),o(i(139),e),o(i(11),e),o(i(16),e),o(i(46),e),o(i(140),e),o(i(12),e),o(i(141),e),o(i(49),e),o(i(142),e),o(i(143),e),o(i(17),e),o(i(144),e),o(i(50),e),o(i(51),e),o(i(145),e),o(i(146),e),o(i(47),e),o(i(48),e),o(i(32),e),o(i(147),e),o(i(26),e),o(i(43),e),o(i(25),e),o(i(44),e),o(i(148),e),o(i(7),e),o(i(34),e),o(i(149),e),o(i(150),e),o(i(151),e),o(i(42),e),o(i(41),e),o(i(4),e),o(i(18),e),o(i(52),e),o(i(53),e),o(i(24),e),o(i(152),e)},function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),o(i(78),e),o(i(79),e),o(i(80),e)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(e,i,r){var o=t.call(this)||this;return o.chain=e,o.filter=null!=i?i:null,o.filterOwner=r,o._isActivated=!1,o}return o(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.addOnce=function(e,i){t.prototype.addOnce.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.remove=function(e,i){t.prototype.remove.call(this,e,i),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.removeAll=function(e){t.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},e.prototype._onChainTriggerFired=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},e}(i(31).Trigger);e.ChainTrigger=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CompositeOperation=void 0,function(t){t[t.SourceOver=0]="SourceOver",t[t.SourceAtop=1]="SourceAtop",t[t.Lighter=2]="Lighter",t[t.Copy=3]="Copy",t[t.ExperimentalSourceIn=4]="ExperimentalSourceIn",t[t.ExperimentalSourceOut=5]="ExperimentalSourceOut",t[t.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",t[t.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",t[t.DestinationOut=8]="DestinationOut",t[t.DestinationOver=9]="DestinationOver",t[t.Xor=10]="Xor"}(e.CompositeOperation||(e.CompositeOperation={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AssetLoadErrorType=void 0,function(t){t[t.Unspecified=0]="Unspecified",t[t.RetryLimitExceeded=1]="RetryLimitExceeded",t[t.NetworkError=2]="NetworkError",t[t.ClientError=3]="ClientError",t[t.ServerError=4]="ServerError"}(e.AssetLoadErrorType||(e.AssetLoadErrorType={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FontWeight=void 0,function(t){t[t.Normal=0]="Normal",t[t.Bold=1]="Bold"}(e.FontWeight||(e.FontWeight={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FontFamily=void 0,function(t){t[t.SansSerif=0]="SansSerif",t[t.Serif=1]="Serif",t[t.Monospace=2]="Monospace"}(e.FontFamily||(e.FontFamily={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.FrameSprite=void 0;var n=i(0),s=function(t){function e(e){var i=t.call(this,e)||this;return i._lastUsedIndex=0,i.frameNumber=e.frameNumber||0,i.frames=null!=e.frames?e.frames:[0],i.interval=e.interval,i._timer=void 0,i.loop=null==e.loop||e.loop,i.onFinish=new n.Trigger,i.finished=i.onFinish,i._modifiedSelf(),i}return o(e,t),e.createBySprite=function(t,i,r){var o=new e({scene:t.scene,src:t.src,width:void 0===i?t.width:i,height:void 0===r?t.height:r});return o.srcHeight=void 0===r?t.srcHeight:r,o.srcWidth=void 0===i?t.srcWidth:i,o},e.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.onElapse.add(this._handleElapse,this)},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e)},e.prototype.stop=function(){this._timer&&this._free()},e.prototype.modified=function(e){this._modifiedSelf(e),t.prototype.modified.call(this,e)},e.prototype._handleElapse=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.onFinish.fire()):this.frameNumber++,this.modified()},e.prototype._free=function(){this._timer&&(this._timer.onElapse.remove(this._handleElapse,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},e.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this._surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},e.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},e}(i(21).Sprite);e.FrameSprite=s},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Label=void 0;var n=i(34),s=i(4),a=i(19),h=function(t){function e(e){var i=t.call(this,e)||this;return i.text=e.text,i.font=e.font,i.textAlign=null!=e.textAlign?e.textAlign:n.TextAlign.Left,i.glyphs=new Array(e.text.length),i.fontSize=null!=e.fontSize?e.fontSize:e.font.size,i.maxWidth=e.maxWidth,i.widthAutoAdjust=null==e.widthAutoAdjust||e.widthAutoAdjust,i.textColor=e.textColor,i._realTextAlign="left",i._textWidth=0,i._overhangLeft=0,i._overhangRight=0,i._invalidateSelf(),i}return o(e,t),e.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},e.prototype.invalidate=function(){this._invalidateSelf(),t.prototype.invalidate.call(this)},e.prototype.renderSelfFromCache=function(t){var e;switch(this._realTextAlign){case"center":e=this.widthAutoAdjust?this._overhangLeft:0;break;case"right":e=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:e=this._overhangLeft}t.drawImage(this._cache,0,0,this._cacheSize.width+a.CacheableE.PADDING,this._cacheSize.height+a.CacheableE.PADDING,e,0)},e.prototype.renderCache=function(t){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var e=this.maxWidth&&this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,i=0;switch(this._realTextAlign){case"center":i=this.width/2-(this._textWidth+this._overhangLeft)/2*e;break;case"right":i=this.width-(this._textWidth+this._overhangLeft)*e;break;default:i-=this._overhangLeft*e}t.translate(Math.round(i),0),1!==e&&t.transform([e,0,0,1,0,0]),t.save();for(var r=this.fontSize/this.font.size,o=0,n=0;n<this.glyphs.length;++n){var s=this.glyphs[n],a=s.advanceWidth*r,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(t.save(),t.translate(Math.round(o),0),t.transform([r,0,0,r,0,0]),t.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),t.restore()),o+=a):this._outputOfWarnLogWithNoGlyph(h,"renderCache()")}t.restore(),t.save(),this.textColor&&(t.setCompositeOperation("source-atop"),t.fillRect(0,0,this._textWidth,this.height,this.textColor)),t.restore()}},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype._invalidateSelf=function(){this.glyphs.length=0,this._textWidth=0;var t=this.textAlign;if(this._realTextAlign="string"==typeof t?t:s.Util.enumToSnakeCase(n.TextAlign,t),this.fontSize){for(var e=this.text.length-1,i=this.text.length-1;i>=0;--i){var r=s.Util.charCodeAt(this.text,i);if(r)if((h=this.font.glyphForCharacter(r))&&0!==h.width&&0!==h.advanceWidth){e=i;break}}var o=0,a=this.font.size>0?this.fontSize/this.font.size:0;for(i=0;i<=e;++i){var h,u=s.Util.charCodeAt(this.text,i);if(u)if(h=this.font.glyphForCharacter(u)){if(!(h.width<0||h.height<0||h.x<0||h.y<0)){this.glyphs.push(h);var c=0;0===i&&(this._overhangLeft=Math.min(h.offsetX,0),c=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(h.width+h.offsetX-h.advanceWidth,0),c+=this._overhangRight),this._textWidth+=(h.advanceWidth+c)*a;var l=h.offsetY+h.height;o<l&&(o=l)}}else this._outputOfWarnLogWithNoGlyph(u,"_invalidateSelf()")}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*a}else this.height=0},e.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);console.warn("Label#"+e+": failed to get a glyph for '"+i+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},e}(a.CacheableE);e.Label=h},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Pane=void 0;var n=i(7),s=function(t){function e(e){var i=t.call(this,e)||this;return i._oldWidth=e.width,i._oldHeight=e.height,i.backgroundImage=e.backgroundImage,i._beforeBackgroundImage=e.backgroundImage,i._backgroundImageSurface=n.SurfaceUtil.asSurface(e.backgroundImage),i.backgroundEffector=e.backgroundEffector,i._shouldRenderChildren=!1,i._padding=e.padding||0,i._initialize(),i._paddingChanged=!1,i}return o(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!1,configurable:!0}),e.prototype.modified=function(e){e&&(this.state&=-3),t.prototype.modified.call(this)},e.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},e.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this._backgroundImageSurface&&t.drawImage(this._backgroundImageSurface,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},e.prototype.destroy=function(e){e&&this._backgroundImageSurface&&!this._backgroundImageSurface.destroyed()&&this._backgroundImageSurface.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._backgroundImageSurface=void 0,this._beforeBackgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,t.prototype.destroy.call(this)},e.prototype._renderBackground=function(){if(this.backgroundImage!==this._beforeBackgroundImage&&(this._backgroundImageSurface=n.SurfaceUtil.asSurface(this.backgroundImage),this._beforeBackgroundImage=this.backgroundImage),this._backgroundImageSurface&&this.backgroundEffector){var t=this.backgroundEffector.render(this._backgroundImageSurface,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},e.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},e.prototype._initialize=function(){var t,e=this._padding;t="number"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},e.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var i={left:0,right:this.width,top:0,bottom:this.height},r=[{x:i.left,y:i.top},{x:i.left,y:i.bottom},{x:i.right,y:i.top},{x:i.right,y:i.bottom}],o=e.multiplyPoint(r[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},s=1;s<r.length;++s)o=e.multiplyPoint(r[s]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);return n}},e}(i(19).CacheableE);e.Pane=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EmptyVectorImageAsset=void 0;var r=i(0),o=function(){function t(t,e,i,o,n){this.type="vector-image",this.width=0,this.height=0,this.onDestroyed=new r.Trigger,this.id=t,this.path=e,this.originalPath=e,this.width=i,this.height=o,this.hint=n}return t.prototype.createSurface=function(t,e,i,r,o,n){return null},t.prototype.inUse=function(){return!1},t.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.destroy(),this.onDestroyed=void 0)},t.prototype.destroyed=function(){return!this.onDestroyed},t.prototype._load=function(t){t._onAssetLoad(this)},t.prototype._assetPathFilter=function(t){return t},t}();e.EmptyVectorImageAsset=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Collision=void 0;var r=i(4);function o(t,e){return t.x*e.y-t.y*e.x}function n(t,e){return{x:t.x-e.x,y:t.y-e.y}}!function(t){t.intersectEntities=function(e,i,r,s){var a=e._findLowestCommonAncestorWith(i);if(!a)return!1;var h=r?{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height}:{left:0,top:0,right:e.width,bottom:e.height},u=s?{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height}:{left:0,top:0,right:i.width,bottom:i.height},c=e._calculateMatrixTo(a),l=i._calculateMatrixTo(a),d=c.multiplyPoint({x:h.left,y:h.top}),p=c.multiplyPoint({x:h.right,y:h.top}),f=c.multiplyPoint({x:h.left,y:h.bottom}),_=c.multiplyPoint({x:h.right,y:h.bottom}),y=l.multiplyPoint({x:u.left,y:u.top}),v=l.multiplyPoint({x:u.right,y:u.top}),g=l.multiplyPoint({x:u.left,y:u.bottom}),m=l.multiplyPoint({x:u.right,y:u.bottom}),A=Math.min(d.x,p.x,f.x,_.x),x=Math.max(d.x,p.x,f.x,_.x),P=Math.min(y.x,v.x,g.x,m.x),S=Math.max(y.x,v.x,g.x,m.x);if(x<P||S<A)return!1;var b=Math.min(d.y,p.y,f.y,_.y),w=Math.max(d.y,p.y,f.y,_.y),E=Math.min(y.y,v.y,g.y,m.y),O=Math.max(y.y,v.y,g.y,m.y);if(w<E||O<b)return!1;if(t.intersectLineSegments(d,p,y,v)||t.intersectLineSegments(d,p,v,m)||t.intersectLineSegments(d,p,m,g)||t.intersectLineSegments(d,p,g,y)||t.intersectLineSegments(p,_,y,v)||t.intersectLineSegments(p,_,v,m)||t.intersectLineSegments(p,_,m,g)||t.intersectLineSegments(p,_,g,y)||t.intersectLineSegments(_,f,y,v)||t.intersectLineSegments(_,f,v,m)||t.intersectLineSegments(_,f,m,g)||t.intersectLineSegments(_,f,g,y)||t.intersectLineSegments(f,d,y,v)||t.intersectLineSegments(f,d,v,m)||t.intersectLineSegments(f,d,m,g)||t.intersectLineSegments(f,d,g,y))return!0;var T=o(n(d,p),n(y,p));if(T*o(n(f,d),n(y,d))>=0&&T*o(n(_,f),n(y,f))>=0&&T*o(n(p,_),n(y,_))>=0)return!0;var M=o(n(y,v),n(d,v));return M*o(n(g,y),n(d,y))>=0&&M*o(n(m,g),n(d,g))>=0&&M*o(n(v,m),n(d,m))>=0},t.intersectLineSegments=function(t,e,i,r){var s=n(e,t),a=n(r,i);return o(n(i,t),s)*o(n(r,t),s)<=0&&o(n(t,i),a)*o(n(e,i),a)<=0},t.intersect=function(t,e,i,r,o,n,s,a){return t<=o+s&&o<=t+i&&e<=n+a&&n<=e+r},t.intersectAreas=function(e,i){return t.intersect(e.x,e.y,e.width,e.height,i.x,i.y,i.width,i.height)},t.within=function(t,e,i,o,n){return void 0===n&&(n=1),n>=r.Util.distance(t,e,i,o)},t.withinAreas=function(t,e,i){return void 0===i&&(i=1),i>=r.Util.distanceBetweenAreas(t,e)}}(e.Collision||(e.Collision={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AssetHolder=void 0;var r=i(1),o=function(){function t(t){var e=t.assetManager,i=t.assetIds?t.assetIds.concat():[];i.push.apply(i,e.resolvePatternsToAssetIds(t.assetPaths||[])),this.waitingAssetsCount=i.length,this.userData=t.userData,this._assetManager=e,this._assetIds=i,this._assets=[],this._handlerSet=t.handlerSet,this._requested=!1}return t.prototype.request=function(){return 0!==this.waitingAssetsCount&&(this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this)),!0)},t.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this.userData=void 0,this._handlerSet=void 0,this._assetIds=void 0,this._requested=!1},t.prototype.destroyed=function(){return!this._handlerSet},t.prototype._onAssetError=function(t,e){var i=this._handlerSet;if(!this.destroyed()&&!i.owner.destroyed()){var r={asset:t,error:e,cancelRetry:!1};i.handleLoadFailure.call(i.owner,r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&i.handleFinish.call(i.owner,this,!1)}},t.prototype._onAssetLoad=function(t){var e=this._handlerSet;if(!(this.destroyed()||e.owner.destroyed()||(e.handleLoad.call(e.owner,t),this._assets.push(t),--this.waitingAssetsCount,this.waitingAssetsCount>0))){if(this.waitingAssetsCount<0)throw r.ExceptionFactory.createAssertionError("AssetHolder#_onAssetLoad: broken waitingAssetsCount");e.handleFinish.call(e.owner,this,!0)}},t}();e.AssetHolder=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.DynamicFont=void 0;var n=i(14),s=i(38),a=i(22),h=i(25),u=i(4),c=function(t){function e(e){var i=t.call(this)||this;i.fontFamily=e.fontFamily,i.size=e.size,i.hint=null!=e.hint?e.hint:{},i.fontColor=null!=e.fontColor?e.fontColor:"black",i.fontWeight=null!=e.fontWeight?e.fontWeight:n.FontWeight.Normal,i.strokeWidth=null!=e.strokeWidth?e.strokeWidth:0,i.strokeColor=null!=e.strokeColor?e.strokeColor:"black",i.strokeOnly=null!=e.strokeOnly&&e.strokeOnly;var r=e.game;i._resourceFactory=r.resourceFactory;var o,s=i.fontFamily;if("string"==typeof s)o=s;else if(Array.isArray(s)){for(var a=[],c=0;c<s.length;++c){var l=s[c];a.push("string"==typeof l?l:u.Util.enumToSnakeCase(n.FontFamily,l))}o=a}else{(a=[]).push("string"==typeof s?s:u.Util.enumToSnakeCase(n.FontFamily,s)),o=a}var d=i.fontWeight,p="string"==typeof d?d:u.Util.enumToSnakeCase(n.FontWeight,d);if(i._glyphFactory=i._resourceFactory.createGlyphFactory(o,i.size,i.hint.baselineHeight,i.fontColor,i.strokeWidth,i.strokeColor,i.strokeOnly,p),i._glyphs={},i._destroyed=!1,i._isSurfaceAtlasSetOwner=!1,e.surfaceAtlasSet?i._atlasSet=e.surfaceAtlasSet:e.hint?(i._isSurfaceAtlasSetOwner=!0,i._atlasSet=new h.SurfaceAtlasSet({resourceFactory:r.resourceFactory,hint:i.hint})):i._atlasSet=r.surfaceAtlasSet,i.hint.presetChars){c=0;for(var f=i.hint.presetChars.length;c<f;c++){var _=u.Util.charCodeAt(i.hint.presetChars,c);_&&i.glyphForCharacter(_)}}return i}return o(e,t),e.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if((e=this._glyphFactory.create(t)).surface&&!this._atlasSet.addGlyph(e))return null;this._glyphs[t]=e}return this._atlasSet.touchGlyph(e),e},e.prototype.asBitmapFont=function(t){var e=this;if(1!==this._atlasSet.getAtlasNum())return null;var i=null;t&&(i=u.Util.charCodeAt(t,0),this.glyphForCharacter(i));var r={};Object.keys(this._glyphs).forEach((function(t){var i=Number(t),o=e._glyphs[i],n={x:o.x,y:o.y,width:o.width,height:o.height,offsetX:o.offsetX,offsetY:o.offsetY,advanceWidth:o.advanceWidth};r[i]=n}));var o=r[i],n=this._atlasSet.getAtlas(0),a=n.getAtlasUsedSize(),h=this._resourceFactory.createSurface(a.width,a.height),c=h.renderer();return c.begin(),c.drawImage(n._surface,0,0,a.width,a.height,0,0),c.end(),new s.BitmapFont({src:h,map:r,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:o})},e.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=void 0,this._glyphFactory=void 0,this._destroyed=!0},e.prototype.destroyed=function(){return this._destroyed},e}(a.Font);e.DynamicFont=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NinePatchSurfaceEffector=void 0;var r=i(7),o=function(){function t(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return t.prototype.render=function(t,e,i){return this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t||(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t),r.SurfaceUtil.drawNinePatch(this._surface,t,this.borderWidth),this._surface},t}();e.NinePatchSurfaceEffector=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteFactory=void 0;var r=i(21),o=i(1),n=function(){function t(){}return t.createSpriteFromE=function(t,e,i){var n=e.x,s=e.y,a=0,h=0,u=e.width,c=e.height,l=e.calculateBoundingRect();if(!l)throw o.ExceptionFactory.createAssertionError("SpriteFactory.createSpriteFromE: camera must look e");u=l.right-l.left,c=l.bottom-l.top,l.left<e.x&&(a=e.x-l.left),l.top<e.y&&(h=e.y-l.top),e.moveTo(a,h),e._matrix&&(e._matrix._modified=!0);var d=t.game.resourceFactory.createSurface(Math.ceil(u),Math.ceil(c)),p=d.renderer();p.begin(),e.render(p,i),p.end();var f=new r.Sprite({scene:t,src:d,width:u,height:c});return f.moveTo(l.left,l.top),e.moveTo(n,s),e._matrix&&(e._matrix._modified=!0),f},t.createSpriteFromScene=function(t,e,i){var o=t.game.resourceFactory.createSurface(Math.ceil(e.game.width),Math.ceil(e.game.height)),n=o.renderer();n.begin();for(var s=e.children,a=0;a<s.length;++a)s[a].render(n,i);return n.end(),new r.Sprite({scene:t,src:o,width:e.game.width,height:e.game.height})},t}();e.SpriteFactory=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var r=i(0),o=i(36),n=i(37),s=i(40),a=i(45),h=i(1),u=i(23),c=i(46),l=i(49),d=i(50),p=i(24),f=i(26),_=i(25),y=i(53),v=function(){function t(t){var e=this._normalizeConfiguration(t.configuration);this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.age=0,this.assetBase=t.assetBase||"",this.resourceFactory=t.resourceFactory,this.handlerSet=t.handlerSet,this.selfId=t.selfId,this.db=void 0,this.loadingScene=void 0,this.operationPlugins=void 0,this.random=void 0,this.localRandom=void 0,this._defaultLoadingScene=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this._idx=void 0,this._localDb=void 0,this._localIdx=void 0,this._cameraIdx=void 0,this._isTerminated=void 0,this._modified=void 0,this._postTickTasks=void 0,this.playId=void 0,this.isSkipping=!1,this.joinedPlayerIds=[],this.audio=new n.AudioSystemManager(this.resourceFactory),this.defaultAudioSystemId="sound",this.storage=new f.Storage,this.assets={},this.surfaceAtlasSet=new _.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this.onJoin=new r.Trigger,this.onLeave=new r.Trigger,this.onPlayerInfo=new r.Trigger,this.onSeed=new r.Trigger,this.join=this.onJoin,this.leave=this.onLeave,this.playerInfo=this.onPlayerInfo,this.seed=this.onSeed,this._eventTriggerMap={unknown:void 0,timestamp:void 0,join:this.onJoin,leave:this.onLeave,"player-info":this.onPlayerInfo,seed:this.onSeed,message:void 0,"point-down":void 0,"point-move":void 0,"point-up":void 0,operation:void 0},this.onResized=new r.Trigger,this.onSkipChange=new r.Trigger,this.resized=this.onResized,this.skippingChanged=this.onSkipChange,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this._onLoad=new r.Trigger,this._onStart=new r.Trigger,this._loaded=this._onLoad,this._started=this._onStart,this.isLoaded=!1,this.onSnapshotRequest=new r.Trigger,this.snapshotRequest=this.onSnapshotRequest,this.external={},this._runtimeValueBase=Object.create(t.engineModule,{game:{value:this,enumerable:!0}}),this._main=e.main,this._mainFunc=t.mainFunc,this._mainParameter=void 0,this._configuration=e,this._assetManager=new o.AssetManager(this,e.assets,e.audio,e.moduleMainScripts),this._moduleManager=void 0;var i=e.operationPlugins||[];this.operationPluginManager=new l.OperationPluginManager(this,t.operationPluginViewInfo||null,i),this._onOperationPluginOperated=new r.Trigger,this._operationPluginOperated=this._onOperationPluginOperated,this.operationPluginManager.onOperate.add(this._onOperationPluginOperated.fire,this._onOperationPluginOperated),this.onSceneChange=new r.Trigger,this._onSceneChange=new r.Trigger,this._onSceneChange.add(this._handleSceneChanged,this),this._sceneChanged=this._onSceneChange,this._initialScene=new p.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.onLoad.add(this._handleInitialSceneLoad,this),this._reset({age:0})}return Object.defineProperty(t.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this._modified&&this.render(),this._focusingCamera=t)},enumerable:!1,configurable:!0}),t.prototype.pushScene=function(t){this._postTickTasks.push({type:0,scene:t})},t.prototype.replaceScene=function(t,e){this._postTickTasks.push({type:1,scene:t,preserveCurrent:!!e})},t.prototype.popScene=function(t,e){void 0===e&&(e=1);for(var i=0;i<e;i++)this._postTickTasks.push({type:2,preserveCurrent:!!t})},t.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},t.prototype.tick=function(t,e,i){var r=null;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(r=this.scenes[this.scenes.length-1],i&&i.length)for(var o=0;o<i.length;++o){var n=this._eventConverter.toGameEvent(i[o]),s=this._eventTriggerMap[n.type];s&&s.fire(n)}r.onUpdate.fire(),t&&++this.age}return!!this._postTickTasks.length&&(this._flushPostTickTasks(),r!==this.scenes[this.scenes.length-1])},t.prototype.render=function(){if(this._modified){var t=this.scene();if(t){for(var e=this.focusingCamera,i=this.renderers,r=0;r<i.length;++r){var o=i[r];o.begin(),o.save(),o.clear(),e&&(o.save(),e._applyTransformToRenderer(o));for(var n=t.children,s=0;s<n.length;++s)n[s].render(o,e);e&&o.restore(),o.restore(),o.end()}this._modified=!1}}},t.prototype.resolvePointEvent=function(t){switch(t.type){case 0:return this._pointEventResolver.pointDown(t);case 1:return this._pointEventResolver.pointMove(t);case 2:return this._pointEventResolver.pointUp(t)}},t.prototype.findPointSource=function(t,e){e||(e=this.focusingCamera);var i=this.scene();if(i)return i.findPointSourceByPoint(t,!1,e)},t.prototype.register=function(t){if(t.local){if(void 0===t.id)t.id=--this._localIdx;else{if(t.id>0)throw h.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+t.id);if(this._localDb.hasOwnProperty(String(t.id)))throw h.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._localIdx>t.id&&(this._localIdx=t.id)}this._localDb[t.id]=t}else{if(void 0===t.id)t.id=++this._idx;else{if(t.id<0)throw h.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+t.id);if(this.db.hasOwnProperty(String(t.id)))throw h.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._idx<t.id&&(this._idx=t.id)}this.db[t.id]=t}},t.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},t.prototype.terminateGame=function(){this._isTerminated=!0,this._terminateGame()},t.prototype.modified=function(){this._modified=!0},t.prototype.raiseEvent=function(t){this.handlerSet.raiseEvent(this._eventConverter.toPlaylogEvent(t))},t.prototype.raiseTick=function(t){if(null!=t&&t.length){for(var e=[],i=0;i<t.length;i++)e.push(this._eventConverter.toPlaylogEvent(t[i]));this.handlerSet.raiseTick(e)}else this.handlerSet.raiseTick()},t.prototype.addEventFilter=function(t,e){this.handlerSet.addEventFilter(t,e)},t.prototype.removeEventFilter=function(t){this.handlerSet.removeEventFilter(t)},t.prototype.shouldSaveSnapshot=function(){return this.handlerSet.shouldSaveSnapshot()},t.prototype.saveSnapshot=function(t,e){this.handlerSet.saveSnapshot(this.age,t,this.random.serialize(),this._idx,e)},t.prototype.getCurrentTime=function(){return this.handlerSet.getCurrentTime()},t.prototype.isActiveInstance=function(){return"active"===this.handlerSet.getInstanceType()},t.prototype._pushPostTickTask=function(t,e){this._postTickTasks.push({type:3,fun:t,owner:e})},t.prototype._normalizeConfiguration=function(t){if(!t)throw h.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if(null==t.assets&&(t.assets={}),null==t.fps&&(t.fps=30),"number"!=typeof t.fps)throw h.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=t.fps&&t.fps<=60))throw h.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof t.width)throw h.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof t.height)throw h.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return t},t.prototype._setAudioPlaybackRate=function(t){this.audio._setPlaybackRate(t)},t.prototype._setMuted=function(t){this.audio._setMuted(t)},t.prototype._decodeOperationPluginOperation=function(t,e){var i=this.operationPluginManager.plugins[t];return i&&i.decode?i.decode(e):e},t.prototype._reset=function(t){if(this.operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this.isLoaded||this.scenes.pop()}switch(t&&(void 0!==t.age&&(this.age=t.age),void 0!==t.nextEntityId&&(this._idx=t.nextEntityId),void 0!==t.randGenSer?this.random=y.XorshiftRandomGenerator.deserialize(t.randGenSer):void 0!==t.randSeed&&(this.random=new y.XorshiftRandomGenerator(t.randSeed))),this.audio._reset(),this._onLoad.removeAll({func:this._handleLoad,owner:this}),this.onJoin.removeAll(),this.onLeave.removeAll(),this.onSeed.removeAll(),this.onResized.removeAll(),this.onSkipChange.removeAll(),this.onSceneChange.removeAll(),this.handlerSet.removeAllEventFilters(),this.isSkipping=!1,this.onSkipChange.add(this._handleSkipChange,this),this.joinedPlayerIds=[],this.onJoin.add(this._handleJoinEvent,this),this.onLeave.add(this._handleLeaveEvent,this),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this._modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this.onSnapshotRequest.removeAll(),this._postTickTasks=[],this._eventConverter=new a.EventConverter({game:this,playerId:this.selfId}),this._pointEventResolver=new d.PointEventResolver({sourceResolver:this,playerId:this.selfId}),this.localRandom=new y.XorshiftRandomGenerator(Math.floor(9007199254740991*Math.random())),this._isTerminated=!1,this.vars={},this._moduleManager=new c.ModuleManager(this._runtimeValueBase,this._assetManager),this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new _.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new u.LoadingScene({game:this});break;case"compact":this._defaultLoadingScene=new s.DefaultLoadingScene({game:this,style:"compact"});break;default:this._defaultLoadingScene=new s.DefaultLoadingScene({game:this})}},t.prototype._destroy=function(){if(this.operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this._modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0,this.audio.music.stopAll(),this.audio.sound.stopAll(),this.audio=void 0,this.defaultAudioSystemId=void 0,this.handlerSet=void 0,this.localRandom=void 0,this.onJoin.destroy(),this.onJoin=void 0,this.onLeave.destroy(),this.onLeave=void 0,this.onSeed.destroy(),this.onSeed=void 0,this.onPlayerInfo.destroy(),this.onPlayerInfo=void 0,this.onResized.destroy(),this.onResized=void 0,this.onSkipChange.destroy(),this.onSkipChange=void 0,this.onSceneChange.destroy(),this.onSceneChange=void 0,this.onSnapshotRequest.destroy(),this.onSnapshotRequest=void 0,this.join=void 0,this.leave=void 0,this.seed=void 0,this.playerInfo=void 0,this.snapshotRequest=void 0,this.resized=void 0,this.skippingChanged=void 0,this._sceneChanged=void 0,this._loaded=void 0,this._started=void 0,this._operationPluginOperated=void 0,this._onSceneChange.destroy(),this._onSceneChange=void 0,this._onLoad.destroy(),this._onLoad=void 0,this._onStart.destroy(),this._onStart=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._main=void 0,this._mainFunc=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this.operationPluginManager=void 0,this._onOperationPluginOperated.destroy(),this._onOperationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._postTickTasks=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0,this._moduleManager=void 0},t.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._handleLoad():(this._onLoad.add(this._handleLoad,this),this.pushScene(this._initialScene),this._flushPostTickTasks())},t.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw h.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushPostTickTasks()},t.prototype._updateEventTriggers=function(t){if(this._modified=!0,!t)return this._eventTriggerMap.message=void 0,this._eventTriggerMap["point-down"]=void 0,this._eventTriggerMap["point-move"]=void 0,this._eventTriggerMap["point-up"]=void 0,void(this._eventTriggerMap.operation=void 0);this._eventTriggerMap.message=t.onMessage,this._eventTriggerMap["point-down"]=t.onPointDownCapture,this._eventTriggerMap["point-move"]=t.onPointMoveCapture,this._eventTriggerMap["point-up"]=t.onPointUpCapture,this._eventTriggerMap.operation=t.onOperation,t._activate()},t.prototype._handleInitialSceneLoad=function(){this._initialScene.onLoad.remove(this._handleInitialSceneLoad,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._onLoad.fire(this)},t.prototype._handleOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this.handlerSet.raiseEvent(e)},t.prototype._handleSceneChanged=function(t){this._updateEventTriggers(t);var e=t?t.local:"full-local",i=t?t.tickGenerationMode:"by-clock";this.lastLocalTickMode===e&&this.lastTickGenerationMode===i||(this.lastLocalTickMode=e,this.lastTickGenerationMode=i,this.handlerSet.changeSceneMode({local:e,tickGenerationMode:i}))},t.prototype._terminateGame=function(){},t.prototype._flushPostTickTasks=function(){do{var t=this._postTickTasks;this._postTickTasks=[];for(var e=0;e<t.length;++e){var i=t[e];switch(i.type){case 0:var r=this.scene();r&&r._deactivate(),this._doPushScene(i.scene);break;case 1:i.scene.prefetch(),this._doPopScene(i.preserveCurrent,!1),this._doPushScene(i.scene);break;case 2:this._doPopScene(i.preserveCurrent,!0);break;case 3:i.fun.call(i.owner);break;default:throw h.ExceptionFactory.createAssertionError("Game#_flushPostTickTasks: unknown post-tick task type.")}}}while(this._postTickTasks.length>0)},t.prototype._handleSkipChange=function(t){this.isSkipping=t},t.prototype._handleJoinEvent=function(t){t.player.id&&-1===this.joinedPlayerIds.indexOf(t.player.id)&&this.joinedPlayerIds.push(t.player.id)},t.prototype._handleLeaveEvent=function(t){this.joinedPlayerIds=this.joinedPlayerIds.filter((function(e){return e!==t.player.id}))},t.prototype._doPopScene=function(t,e){var i=this.scenes.pop();if(!i)throw h.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; scene stack underflow");if(i===this._initialScene)throw h.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");if(t||i.destroy(),e){var r=this.scene();this.onSceneChange.fire(r),this._onSceneChange.fire(r)}},t.prototype._handleLoad=function(){if(this.operationPluginManager.initialize(),this.operationPlugins=this.operationPluginManager.plugins,this._mainFunc)this._mainFunc(this._runtimeValueBase,this._mainParameter||{});else{if(!this._main)throw h.ExceptionFactory.createAssertionError("Game#_handleLoad: does not have an entry point");var t=this._moduleManager._require(this._main);if(!t||"function"!=typeof t)throw h.ExceptionFactory.createAssertionError("Game#_handleLoad: Entry point "+this._main+" not found.");t(this._mainParameter)}this._flushPostTickTasks(),this._onStart.fire()},t.prototype._doPushScene=function(t,e){if(e||(e=this.loadingScene||this._defaultLoadingScene),this.scenes.push(t),t._needsLoading()&&"loaded-fired"!==t._loadingState){if(this._defaultLoadingScene._needsLoading())throw h.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(e,this._defaultLoadingScene),e.reset(t)}else this.onSceneChange.fire(t),this._onSceneChange.fire(t),t._loaded||(t._load(),this._pushPostTickTask(t._fireLoaded,t));this._modified=!0},t}();e.Game=v},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.GameHandlerSet=void 0;var s=n(i(10)),a=function(){function t(t){this.raiseEventTrigger=new s.Trigger,this.raiseTickTrigger=new s.Trigger,this.changeSceneModeTrigger=new s.Trigger,this.snapshotTrigger=new s.Trigger,this._eventFilterFuncs=null,this._getCurrentTimeFunc=null,this._local=null,this._tickGenerationMode=null,this.isSnapshotSaver=!!t.isSnapshotSaver}return t.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},t.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},t.prototype.removeAllEventFilters=function(){this._eventFilterFuncs&&this._eventFilterFuncs.removeFilter()},t.prototype.changeSceneMode=function(t){this._local=t.local,this._tickGenerationMode=t.tickGenerationMode,this.changeSceneModeTrigger.fire(t)},t.prototype.getCurrentTime=function(){return null==this._getCurrentTimeFunc?0:Math.floor(this._getCurrentTimeFunc())},t.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},t.prototype.raiseTick=function(t){t&&this.raiseTickTrigger.fire(t)},t.prototype.addEventFilter=function(t,e){this._eventFilterFuncs&&this._eventFilterFuncs.addFilter(t,e)},t.prototype.removeEventFilter=function(t){this._eventFilterFuncs&&this._eventFilterFuncs.removeFilter(t)},t.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},t.prototype.getInstanceType=function(){return this.shouldSaveSnapshot()?"active":"passive"},t.prototype.saveSnapshot=function(t,e,i,r){this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:t,timestamp:r,data:{randGenSer:i,gameSnapshot:e}})},t}();e.GameHandlerSet=a},function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ResourceFactory=void 0;var o=r(i(156)),n=i(157),s=i(158),a=i(173),h=i(175),u=i(176),c=i(178),l=i(209),d=i(210),p=function(){function t(t){this.surfaceFactory=new d.SurfaceFactory(t.canvas),this.audioFactory=new c.AudioFactory,this.assetLoaderFuncs=t.assetLoaderFuncs,this.assetBaseDir=t.assetBaseDir||""}return t.prototype.createAudioAsset=function(t,e,i,r,n,s){return this.audioFactory.createAudioAsset(t,o.default(this.assetBaseDir,e),i,r,n,s)},t.prototype.createAudioPlayer=function(t){return this.audioFactory.createAudioPlayer(t)},t.prototype.createImageAsset=function(t,e,i,r){return new n.ImageAsset(t,o.default(this.assetBaseDir,e),i,r)},t.prototype.createVectorImageAsset=function(t,e,i,r,n){return new a.VectorImageAsset(t,o.default(this.assetBaseDir,e),i,r,n)},t.prototype.createVideoAsset=function(t,e,i,r,n,s,a){return new u.VideoAsset(t,o.default(this.assetBaseDir,e),i,r,n,s,a)},t.prototype.createTextAsset=function(t,e){var i=new h.TextAsset(t,o.default(this.assetBaseDir,e));return this.assetLoaderFuncs&&this.assetLoaderFuncs.loadTextAsset&&i._overrideLoadFunc(this.assetLoaderFuncs.loadTextAsset),i},t.prototype.createScriptAsset=function(t,e){var i=new s.ScriptAsset(t,o.default(this.assetBaseDir,e));return this.assetLoaderFuncs&&this.assetLoaderFuncs.loadScriptAsset&&i._overrideLoadFunc(this.assetLoaderFuncs.loadScriptAsset),i},t.prototype.createPrimarySurface=function(t,e){return this.surfaceFactory.createPrimarySurface(t,e)},t.prototype.createSurface=function(t,e){return this.surfaceFactory.createSurface(t,e)},t.prototype.createGlyphFactory=function(t,e,i,r,o,n,s,a){return new l.GlyphFactory(t,e,i,r,o,n,s,a)},t}();e.ResourceFactory=p},function(t,e,i){var r,o,n;n=function(){function t(t){var e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);if(t[0].match(/^[^/:]+:\/*$/)&&t.length>1){var i=t.shift();t[0]=i+t[0]}t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(var r=0;r<t.length;r++){var o=t[r];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(r>0&&(o=o.replace(/^[\/]+/,"")),o=r<t.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),e.push(o))}var n=e.join("/"),s=(n=n.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return n=s.shift()+(s.length>0?"?":"")+s.join("&")}return function(){return t("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},t.exports?t.exports=n():void 0===(o="function"==typeof(r=n)?r.call(e,i,e,t):r)||(t.exports=o)},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ImageAsset=void 0;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(i(54).HTMLImageAsset);e.ImageAsset=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ScriptAsset=void 0;var n=i(9),s=i(55),a=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="script",r.script="",r.id=e,r.path=i,r}return o(e,t),e.prototype._load=function(t){var e=this;(new n.XHRLoader).get(this.path,(function(i,r){i?t._onAssetError(e,i):(e.script=r+"\n",t._onAssetLoad(e))}))},e.prototype.execute=function(t){return this._wrap()(t),t.module.exports},e.prototype._wrap=function(){return new Function("g","(function(exports, require, module, __filename, __dirname) {\n"+this.script+"})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);\n")},e.prototype._overrideLoadFunc=function(t){var e=this;this._load=function(i){t(e.id,e.path,(function(t,r){t?i._onAssetError(e,s.ExceptionFactory.createAssetLoadError(t.message,!1)):r?(e.script=r+"\n",i._onAssetLoad(e)):i._onAssetError(e,s.ExceptionFactory.createAssetLoadError("no data received",!1))}))}},e}(i(57).Asset);e.ScriptAsset=a},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.AudioAsset=void 0;var n=function(t){function e(e,i,r,o,n,s){var a=t.call(this,e,i)||this;return a.type="audio",a.duration=r,a.loop=n,a.hint=s,a._system=o,a.data=void 0,a}return o(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(i(2).Asset);e.AudioAsset=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AudioPlayer=void 0;var r=i(0),o=function(){function t(t){this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentAudio=void 0,this.volume=t.volume,this._muted=t._muted,this._system=t}return t.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},t.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},t.prototype.canHandleStopped=function(){return!0},t.prototype.changeVolume=function(t){this.volume=t},t.prototype._changeMuted=function(t){this._muted=t},t.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},t}();e.AudioPlayer=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Glyph=void 0;var r=function(){function t(t,e,i,r,o,n,s,a,h,u){void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===u&&(u=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=o,this.offsetX=n,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=u,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();e.Glyph=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GlyphFactory=void 0;var r=function(t,e,i,r,o,n,s,a){void 0===i&&(i=e),void 0===r&&(r="black"),void 0===o&&(o=0),void 0===n&&(n="black"),void 0===s&&(s=!1),void 0===a&&(a="normal"),this.fontFamily=t,this.fontSize=e,this.fontWeight=a,this.baselineHeight=i,this.fontColor=r,this.strokeWidth=o,this.strokeColor=n,this.strokeOnly=s};e.GlyphFactory=r},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ImageAsset=void 0;var n=function(t){function e(e,i,r,o){var n=t.call(this,e,i)||this;return n.type="image",n.width=r,n.height=o,n}return o(e,t),e.prototype.initialize=function(t){this.hint=t},e}(i(2).Asset);e.ImageAsset=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PdiCommonUtil=void 0,function(t){t.addExtname=function(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)}}(e.PdiCommonUtil||(e.PdiCommonUtil={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var r=function(){function t(){}return t.prototype.begin=function(){},t.prototype.end=function(){},t}();e.Renderer=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ResourceFactory=void 0;var r=function(){};e.ResourceFactory=r},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ScriptAsset=void 0;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="script",r.script=void 0,r}return o(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(i(2).Asset);e.ScriptAsset=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Surface=void 0;var r=i(56),o=function(){function t(t,e,i){if(t%1!=0||e%1!=0)throw r.ExceptionFactory.createAssertionError("Surface#constructor: width and height must be integers");this.width=t,this.height=e,this._drawable=i}return t.prototype.destroy=function(){this._destroyed=!0},t.prototype.destroyed=function(){return!!this._destroyed},t}();e.Surface=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.TextAsset=void 0;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="text",r.data=void 0,r}return o(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(i(2).Asset);e.TextAsset=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.VectorImageAsset=void 0;var n=function(t){function e(e,i,r,o,n){var s=t.call(this,e,i)||this;return s.type="vector-image",s.width=r,s.height=o,s.hint=n,s}return o(e,t),e}(i(2).Asset);e.VectorImageAsset=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.VideoAsset=void 0;var n=function(t){function e(e,i,r,o,n,s,a){var h=t.call(this,e,i)||this;return h.type="video",h.width=r,h.height=o,h.realWidth=0,h.realHeight=0,h._system=n,h._loop=s,h._useRealSize=a,h}return o(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.destroy=function(){this._system=void 0,t.prototype.destroy.call(this)},e}(i(2).Asset);e.VideoAsset=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VideoPlayer=void 0;var r=i(0),o=function(){function t(t){this._loop=!!t,this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentVideo=void 0,this.volume=1}return t.prototype.play=function(t){this.currentVideo=t,this.onPlay.fire({player:this,video:t})},t.prototype.stop=function(){var t=this.currentVideo;this.onStop.fire({player:this,video:t})},t.prototype.changeVolume=function(t){this.volume=t},t}();e.VideoPlayer=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.VectorImageAsset=void 0;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(i(58).SVGImageAsset);e.VectorImageAsset=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasRenderingState=void 0;var r=i(61),o=function(t){t?(this.fillStyle=t.fillStyle,this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new r.AffineTransformer(t.transformer)):(this.fillStyle="#000000",this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new r.AffineTransformer)};e.CanvasRenderingState=o},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.TextAsset=void 0;var h=a(i(10)),u=i(9),c=i(55),l=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.type="text",r.data="",r.onDestroyed=new h.Trigger,r}return o(e,t),e.prototype._load=function(t){var e=this;(new u.XHRLoader).get(this.path,(function(i,r){i?t._onAssetError(e,i):(e.data=r+"\n",t._onAssetLoad(e))}))},e.prototype._overrideLoadFunc=function(t){var e=this;this._load=function(i){t(e.id,e.path,(function(t,r){t?i._onAssetError(e,c.ExceptionFactory.createAssetLoadError(t.message,!1)):r?(e.data=r,i._onAssetLoad(e)):i._onAssetError(e,c.ExceptionFactory.createAssetLoadError("no data received",!1))}))}},e}(i(57).Asset);e.TextAsset=l},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.VideoAsset=void 0;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(i(63).HTMLVideoAsset);e.VideoAsset=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLVideoPlayer=void 0;var r=i(0),o=function(){function t(t){this._loop=!!t,this.onPlay=new r.Trigger,this.onStop=new r.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentVideo=void 0,this.volume=1,this.isDummy=!0}return t.prototype.play=function(t){},t.prototype.stop=function(){},t.prototype.changeVolume=function(t){},t}();e.HTMLVideoPlayer=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AudioFactory=void 0;var r=i(179),o=i(65),n=function(){function t(){this.audioManager=new o.AudioManager,this.audioPluginManager=new r.AudioPluginManager,this.audioPluginManager.tryInstallPlugin([r.HTMLAudioPlugin,r.WebAudioPlugin])}return t.prototype.createAudioAsset=function(t,e,i,r,o,n){var s=this.audioPluginManager.getActivePlugin().createAsset(t,e,i,r,o,n);return this.audioManager.registerAudioAsset(s),s.onDestroyed.addOnce(this.handleAudioAssetDestroyed,this),s},t.prototype.createAudioPlayer=function(t){return this.audioPluginManager.getActivePlugin().createPlayer(t,this.audioManager)},t.prototype.handleAudioAssetDestroyed=function(t){this.audioManager.removeAudioAsset(t)},t}();e.AudioFactory=n},function(t,e,i){t.exports=i(180)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ProxyAudioPlugin=e.WebAudioPlugin=e.HTMLAudioPlugin=e.AudioPluginRegistry=e.ResourceFactory=e.Platform=void 0;var r=i(181);Object.defineProperty(e,"Platform",{enumerable:!0,get:function(){return r.Platform}});var o=i(67);Object.defineProperty(e,"AudioPluginRegistry",{enumerable:!0,get:function(){return o.AudioPluginRegistry}});var n=i(66);Object.defineProperty(e,"AudioPluginManager",{enumerable:!0,get:function(){return n.AudioPluginManager}});var s=i(198);Object.defineProperty(e,"HTMLAudioPlugin",{enumerable:!0,get:function(){return s.HTMLAudioPlugin}});var a=i(202);Object.defineProperty(e,"ProxyAudioPlugin",{enumerable:!0,get:function(){return a.ProxyAudioPlugin}});var h=i(205);Object.defineProperty(e,"WebAudioPlugin",{enumerable:!0,get:function(){return h.WebAudioPlugin}});var u=i(68);Object.defineProperty(e,"ResourceFactory",{enumerable:!0,get:function(){return u.ResourceFactory}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Platform=void 0;var r=i(64),o=i(65),n=i(182),s=i(66),a=i(67),h=i(187),u=i(68),c=function(){function t(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(a.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new o.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new u.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new n.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var i=new r.XHRTextAsset("(game.json)",t);i._load({_onAssetLoad:function(t){e(null,JSON.parse(i.data))},_onAssetError:function(t,i){e(i,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){t?(this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)):this.containerController&&this.containerController.unloadView()},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new h.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.notifyViewMoved=function(){},t.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},t.prototype.getMasterVolume=function(){if(this._audioManager)return this._audioManager.getMasterVolume()},t.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},t}();e.Platform=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerController=void 0;var r=i(0),o=i(183),n=function(){function t(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},t.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},t.prototype.getRenderer=function(){if(!this.surface)throw new Error("this container has no surface");return this.surface.renderer()},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,r=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new o.InputHandlerLayer({width:e,height:i,disablePreventDefault:r}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},t.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},t}();e.ContainerController=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandlerLayer=void 0;var r=i(0),o=i(184),n=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;this._inputHandler=new o.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add((function(e){t.pointEventTrigger.fire(e)})),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},t.prototype.setOffset=function(t){var e="position:relative; left:"+t.x+"px; top:"+t.y+"px";this._inputHandler.inputView.setAttribute("style",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},t.prototype._createInputView=function(t,e){var i=document.createElement("div");return i.setAttribute("tabindex","1"),i.className="input-handler",i.setAttribute("style","display:inline-block; outline:none;"),i.style.width=t+"px",i.style.height=e+"px",i},t}();e.InputHandlerLayer=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.TouchHandler=void 0;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onTouchDown=function(t){for(var e=t.changedTouches,i=0,o=e.length;i<o;i++){var n=e[i];r.pointDown(n.identifier,r.getOffsetPositionFromInputView(n))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchMove=function(t){for(var e=t.changedTouches,i=0,o=e.length;i<o;i++){var n=e[i];r.pointMove(n.identifier,r.getOffsetPositionFromInputView(n))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchUp=function(t){for(var e=t.changedTouches,i=0,o=e.length;i<o;i++){var n=e[i];r.pointUp(n.identifier,r.getOffsetPositionFromInputView(n))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r}return o(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.inputView.addEventListener("touchstart",this.onTouchDown),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchUp)},e.prototype.stop=function(){t.prototype.stop.call(this),this.inputView.removeEventListener("touchstart",this.onTouchDown),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchUp)},e}(i(185).MouseHandler);e.TouchHandler=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.MouseHandler=void 0;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onMouseDown=function(t){0===t.button&&(r.pointDown(1,r.getOffsetPositionFromInputView(t)),window.addEventListener("mousemove",r.onMouseMove,!1),window.addEventListener("mouseup",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseMove=function(t){r.pointMove(1,r.getOffsetPositionFromInputView(t)),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r.onMouseUp=function(t){r.pointUp(1,r.getOffsetPositionFromInputView(t)),window.removeEventListener("mousemove",r.onMouseMove,!1),window.removeEventListener("mouseup",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},r}return o(e,t),e.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1)},e}(i(186).InputAbstractHandler);e.MouseHandler=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InputAbstractHandler=void 0;var r=i(0),o=function(){function t(e,i){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!i,this.pointTrigger=new r.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error("This method is abstract")},t.prototype.stop=function(){throw new Error("This method is abstract")},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},t}();e.InputAbstractHandler=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RafLooper=void 0;var r=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(i){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(i-t._prev),t._prev=i)};this._timerId=requestAnimationFrame((function(i){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=i}))},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();e.RafLooper=r},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.XHRScriptAsset=void 0;var n=i(9),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="script",e}return o(e,t),e.prototype._load=function(t){var e=this;(new n.XHRLoader).get(this.path,(function(i,r){i?t._onAssetError(e,i):(e.script=r+"\n",t._onAssetLoad(e))}))},e.prototype.execute=function(t){return this._wrap()(t),t.module.exports},e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e.prototype._wrap=function(){return new Function("g",e.PRE_SCRIPT+this.script+e.POST_SCRIPT)},e.PRE_SCRIPT="(function(exports, require, module, __filename, __dirname) {",e.POST_SCRIPT="\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);",e}(i(6).Asset);e.XHRScriptAsset=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurfaceFactory=void 0;var r=i(13),o=i(27),n=i(190),s=function(){function t(){}return t.prototype.createPrimarySurface=function(t,e,i){return o.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new n.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new r.Context2DSurface(t,e)},t.prototype.createBackSurface=function(t,e,i){return o.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new r.Context2DSurface(t,e)},t}();e.SurfaceFactory=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLSharedObject=void 0;var r=i(191),o=i(72),n=i(195),s=i(196),a=function(){function t(t,e){var i=new o.WebGLPrimarySurface(this,t,e),r=i.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!r)throw new Error("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._surface=i,this._context=r,this._init()}return t.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},t.prototype.getPrimarySurface=function(){return this._surface},t.prototype.createBackSurface=function(t,e){return new r.WebGLBackSurface(this,t,e)},t.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},t.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},t.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},t.prototype.draw=function(t,e,i,r,o,n,s,a,h){var u;if(this._numSprites>=this._maxSpriteCount&&this._commit(),u=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==u&&(this._commit(),this._currentShaderProgram=u,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var c=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(c[0],c[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+i+o),y=d*(f+r+n),v=l*(p+i),g=d*(f+r);this._register(this._transformVertex(s,a,o,n,t.transformer),[v,g,_,g,_,y,v,g,_,y,v,y])},t.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},t.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},t.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},t.prototype.assignTexture=function(t,e,i,r){if(this._context.bindTexture(this._context.TEXTURE_2D,r),t instanceof HTMLVideoElement)throw new Error("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},t.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData)&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},t.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},t.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,o,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var n=this.getCurrentRenderTarget();return i.bindFramebuffer(i.FRAMEBUFFER,n.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:o}},t.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},t.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},t.prototype.getContext=function(){return this._context},t.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},t.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},t.prototype._init=function(){var t=new n.WebGLShaderProgram(this._context);this._textureAtlas=new s.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation="source-over",this._currentShaderProgram=t,this._defaultShaderProgram=t,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps={"source-atop":[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],"experimental-source-in":[this._context.DST_ALPHA,this._context.ZERO],"experimental-source-out":[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],"source-over":[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],"experimental-destination-atop":[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],"experimental-destination-in":[this._context.ZERO,this._context.SRC_ALPHA],"destination-out":[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],"destination-over":[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],lighter:[this._context.ONE,this._context.ONE],copy:[this._context.ONE,this._context.ZERO],xor:[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA]};var e=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(e[0],e[1])},t.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},t.prototype._transformVertex=function(t,e,i,r,o){var n=this.getCurrentRenderTarget(),s=2/n.width,a=-2/n.height,h=o.matrix,u=s*i*h[0],c=a*i*h[1],l=s*r*h[2],d=a*r*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,u+p,c+f,u+l+p,c+d+f,p,f,u+l+p,c+d+f,l+p,d+f]},t.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;r<6;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},t.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},t}();e.WebGLSharedObject=a},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLBackSurface=void 0;var n=i(192),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},e.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},e}(i(72).WebGLPrimarySurface);e.WebGLBackSurface=s},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLBackSurfaceRenderer=void 0;var n=i(70),s=i(71),a=function(t){function e(e,i){var r=t.call(this,i,i.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:r._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},r}return o(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new s.WebGLRenderingState(this.currentState()),i=e.transformer.matrix;i[1]*=-1,i[3]*=-1,i[5]=-i[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},e.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},e}(n.WebGLRenderer);e.WebGLBackSurfaceRenderer=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLColor=void 0;var r=i(27);!function(t){t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=function(e){var i="string"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return i[3]=r.RenderingHelper.clamp(i[3]),i[0]=r.RenderingHelper.clamp(i[0])*i[3],i[1]=r.RenderingHelper.clamp(i[1])*i[3],i[2]=r.RenderingHelper.clamp(i[2])*i[3],i},t._hsl2rgb=function(t){var e=t[0]%360,i=t[1],r=t[2]>50?100-t[2]:t[2],o=t[3],n=r+r*i,s=r-r*i;return e<60?[n,e/60*(n-s)+s,s,o]:e<120?[(120-e)/60*(n-s)+s,n,s,o]:e<180?[s,n,(e-120)/60*(n-s)+s,o]:e<240?[s,(240-e)/60*(n-s)+s,n,o]:e<300?[(e-240)/60*(n-s)+s,s,n,o]:[n,s,(360-e)/60*(n-s)+s,o]},t._toColor=function(e){var i=e.toUpperCase().replace(/\s+/g,""),o=t.colorMap[i];if(o)return o;if(i.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),r.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),r.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+i)}}(e.WebGLColor||(e.WebGLColor={}))},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLPrimarySurfaceRenderer=void 0;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shared.pushRenderTarget(r._renderTarget),r}return o(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},e}(i(70).WebGLRenderer);e.WebGLPrimarySurfaceRenderer=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLShaderProgram=void 0;var r=function(){function t(e,i,r){var o=t._DEFAULT_VERTEX_SHADER,n=(i=i||t._DEFAULT_FRAGMENT_SHADER,t._makeShaderProgram(e,o,i));this.program=n,this._context=e,this._aVertex=e.getAttribLocation(this.program,"aVertex"),this._uColor=e.getUniformLocation(this.program,"uColor"),this._uAlpha=e.getUniformLocation(this.program,"uAlpha"),this._uSampler=e.getUniformLocation(this.program,"uSampler"),this._uniforms=r,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var o=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(o)}return r},t._makeShaderProgram=function(e,i,r){var o=e.createProgram(),n=t._makeShader(e,e.VERTEX_SHADER,i);e.attachShader(o,n),e.deleteShader(n);var s=t._makeShader(e,e.FRAGMENT_SHADER,r);if(e.attachShader(o,s),e.deleteShader(s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var a=e.getProgramInfoLog(o);throw e.deleteProgram(o),new Error(a)}return o},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;(e.isArray||i!==e.beforeValue)&&(e.update(e.loc,i),e.beforeValue=i)}},t.prototype.initializeUniforms=function(){var t=this,e=[],i=this._uniforms;null!=i&&Object.keys(i).forEach((function(r){var o=i[r].type,n=!("number"==typeof i[r].value);!n||"int"!==o&&"float"!==o||(o+="_v");var s=t._uniformSetterTable[o];if(!s)throw new Error("WebGLShaderProgram#initializeUniforms: Uniform type '"+o+"' is not supported.");e.push({name:r,update:s,beforeValue:null,isArray:n,loc:t._context.getUniformLocation(t.program,r)})})),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",t._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",t}();e.WebGLShaderProgram=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLTextureAtlas=void 0;var r=i(27),o=i(197),n=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4)}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},t.prototype.makeTextureForSurface=function(e,i){var o=i._drawable;if(o&&!o.texture){var n=o.width,s=o.height;if(n>=t.TEXTURE_SIZE||s>=t.TEXTURE_SIZE){var a=r.RenderingHelper.toPowerOfTwo(o.width),h=r.RenderingHelper.toPowerOfTwo(o.height);if(a!==o.width||h!==o.height){var u=document.createElement("canvas");u.width=a,u.height=h;var c=u.getContext("2d");c.globalCompositeOperation="copy",c.drawImage(o,0,0),o=c.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(o),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},t.prototype._assign=function(e,i,r){for(var n,s=0;s<r.length;++s)if(n=r[(s+this._insertPos)%r.length].insert(i))return this._register(e,n,i._drawable),void(this._insertPos=s);n=null,r.length>=t.TEXTURE_COUNT&&(n=r.shift(),e.disposeTexture(n.texture),n.dispose(),e.clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,n.texture)),n||(n=new o.WebGLTextureMap(e.makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),r.push(n),n=n.insert(i),this._register(e,n,i._drawable)},t.prototype._register=function(e,i,r){r.texture=i.texture,r.textureOffsetX=i.offsetX,r.textureOffsetY=i.offsetY,r.textureWidth=t.TEXTURE_SIZE,r.textureHeight=t.TEXTURE_SIZE,e.assignTexture(r,i.offsetX,i.offsetY,i.texture)},t.TEXTURE_SIZE=1024,t.TEXTURE_COUNT=16,t}();e.WebGLTextureAtlas=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebGLTextureMap=void 0;var r=function(){function t(t,e,i,r,o){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=o}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var i=e._drawable,r=i.width+t.TEXTURE_MARGIN,o=i.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var n=this._left.insert(e);if(n)return n}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<r||this._height<o)return null;var a=this._width-r,h=this._height-o;return a<=h?(this._left=new t(this.texture,this.offsetX+r,this.offsetY,a,o),this._right=new t(this.texture,this.offsetX,this.offsetY+o,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+o,r,h),this._right=new t(this.texture,this.offsetX+r,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();e.WebGLTextureMap=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLAudioPlugin=void 0;var r=i(199),o=i(200),n=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),r.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),t.prototype.createAsset=function(t,e,i,o,n,s){return new r.HTMLAudioAsset(t,e,i,o,n,s)},t.prototype.createPlayer=function(t,e){return new o.HTMLAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},t}();e.HTMLAudioPlugin=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLAudioAsset=void 0;var n=i(28),s=i(73),a=i(5),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout((function(){return t._onAssetLoad(i)}),0);var r=new Audio,o=function(t,e){r.autoplay=!1,r.preload="none",r.src=t,i._attachAll(r,e),r.preload="auto",h(r,e),r.load()},n={success:function(){i._detachAll(r,n),i.data=r,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(r,n),i.data=r,t._onAssetError(i,a.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(i._intervalId)}},h=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval((function(){4===t.readyState?e.success():(++i._intervalCount,600===i._intervalCount&&e.error())}),100)},u=this.path.indexOf("?");if(".aac"!==(u>=0?this.path.substring(0,u):this.path).slice(-4)||-1===e.supportedFormats.indexOf("mp4"))o(this.path,n);else{var c={success:n.success,error:function(){i._detachAll(r,c),window.clearInterval(i._intervalId),i.path=s.addExtname(i.originalPath,"mp4"),o(i.path,n)}};o(this.path,c)}},e.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf("ogg")?s.addExtname(t,"ogg"):-1!==e.supportedFormats.indexOf("aac")?s.addExtname(t,"aac"):null},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},e}(n.AudioAsset);e.HTMLAudioAsset=h},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.HTMLAudioPlayer=void 0;var n=i(29),s=i(201),a=function(t){function e(e,i){var r=t.call(this,e)||this;return r._manager=i,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return o(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var i=e.cloneElement();i?(s.setupChromeMEIWorkaround(i),i.volume=this._calculateVolume(),i.play().catch((function(t){})),i.loop=e.loop,i.addEventListener("ended",this._endedEventHandler,!1),i.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=i):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration),t.prototype.play.call(this,e)},e.prototype.stop=function(){this.currentAudio?(this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),t.prototype.stop.call(this)):t.prototype.stop.call(this)},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},e.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);e.HTMLAudioPlayer=a},function(t,e,i){"use strict";var r,o=0,n=[];function s(){a(),document.removeEventListener("keydown",s),document.removeEventListener("mousedown",s),document.removeEventListener("touchend",s)}function a(){o=2,n.forEach((function(t){return t.play()})),n=[]}!function(t){t.setupChromeMEIWorkaround=function(t){function e(){switch(o){case 0:case 1:a()}o=2,clearTimeout(i)}switch(o){case 0:t.addEventListener("play",e,!0);var i=setTimeout((function(){switch(t.removeEventListener("play",e),o){case 0:n.push(t),o=1,document.addEventListener("keydown",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("touchend",s,!0);break;case 1:n.push(t);break;case 2:t.play()}}),100);break;case 1:n.push(t)}}}(r||(r={})),t.exports=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ProxyAudioPlugin=void 0;var r=i(203),o=i(204),n=function(){function t(t){this.supportedFormats=[],this._handlerSet=t}return t.isSupported=function(){return!0},t.prototype.createAsset=function(t,e,i,o,n,s){return new r.ProxyAudioAsset(this._handlerSet,t,e,i,o,n,s)},t.prototype.createPlayer=function(t,e){return new o.ProxyAudioPlayer(this._handlerSet,t,e)},t}();e.ProxyAudioPlugin=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ProxyAudioAsset=void 0;var n=i(28),s=i(5),a=function(t){function e(e,i,r,o,n,s,a){var h=t.call(this,i,r,o,n,s,a)||this;return h._handlerSet=e,h}return o(e,t),e.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint},(function(i){i?t._onAssetError(e,s.ExceptionFactory.createAssetLoadError(i)):t._onAssetLoad(e)}))},e.prototype._assetPathFilter=function(t){return t},e}(n.AudioAsset);e.ProxyAudioAsset=a},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.ProxyAudioPlayer=void 0;var n=function(t){function e(e,i,r){var o=t.call(this,i)||this;return o._audioPlayerId=null,o._handlerSet=e,o._manager=r,o}return o(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},e.prototype.play=function(i){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap"+e._audioPlayerIdCounter++,this._handlerSet.createAudioPlayer({assetId:i.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),t.prototype.play.call(this,i)},e.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},e.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},e.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e._audioPlayerIdCounter=0,e}(i(29).AudioPlayer);e.ProxyAudioPlayer=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebAudioPlugin=void 0;var r=i(206),o=i(207),n=i(208),s=function(){function t(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}return t.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),t.prototype.createAsset=function(t,e,i,o,n,s){return new r.WebAudioAsset(t,e,i,o,n,s)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,o=i.length;r<o;r++){var n=i[r],s=t.canPlayType("audio/"+n);"no"!==s&&""!==s&&e.push(n)}}catch(t){}return e},t}();e.WebAudioPlugin=s},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.WebAudioAsset=void 0;var n=i(28),s=i(73),a=i(5),h=i(9),u=i(30),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout((function(){return t._onAssetLoad(e)}),0);var i=function(i){e.data=i,t._onAssetLoad(e)},r=function(){t._onAssetError(e,a.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))},o=function(t){u.getAudioContext().decodeAudioData(t,i,r)},n=new h.XHRLoader,c=function(t,e,i){n.getArrayBuffer(t,(function(t,r){t?i(t):e(r)}))},l=this.path.indexOf("?");".aac"!==(l>=0?this.path.substring(0,l):this.path).slice(-4)?c(this.path,o,r):c(this.path,o,(function(t){var i=s.addExtname(e.originalPath,"mp4");c(i,(function(t){e.path=i,o(t)}),r)}))},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf("ogg")?s.addExtname(t,"ogg"):-1!==e.supportedFormats.indexOf("aac")?s.addExtname(t,"aac"):null},e.supportedFormats=[],e}(n.AudioAsset);e.WebAudioAsset=c},function(t,e,i){"use strict";var r,o=i(30);function n(){o.getAudioContext().resume(),document.removeEventListener("keydown",n),document.removeEventListener("mousedown",n),document.removeEventListener("touchend",n)}!function(t){t.setupChromeMEIWorkaround=function(){var t=o.getAudioContext();if(!t||"function"==typeof t.resume){var e=o.createGainNode(t),i=t.createOscillator();i.type="sawtooth",i.frequency.value=440,i.connect(e),i.start(0);var r=t.state;i.disconnect(),"running"!==r&&(document.addEventListener("keydown",n,!0),document.addEventListener("mousedown",n,!0),document.addEventListener("touchend",n,!0))}}}(r||(r={})),t.exports=r},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.WebAudioPlayer=void 0;var n=i(29),s=i(30),a=function(t){function e(e,i){var r=t.call(this,e)||this;return r._audioContext=s.getAudioContext(),r._manager=i,r._gainNode=s.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._sourceNode=void 0,r._dummyDurationWaitTimer=null,r._endedEventHandler=function(){r._onAudioEnded()},r}return o(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype.play=function(e){if(this.currentAudio&&this.stop(),e.data){var i=s.createBufferNode(this._audioContext);i.loop=e.loop,i.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},e.prototype.stop=function(){this.currentAudio?(this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),t.prototype.stop.call(this)):t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);e.WebAudioPlayer=a},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.GlyphFactory=void 0;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(a(i(69)).GlyphFactory);e.GlyphFactory=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SurfaceFactory=void 0;var r=i(211),o=i(212),n=function(){function t(t){this.canvas=t}return t.prototype.createPrimarySurface=function(t,e){return new o.PrimaryContext2DSurface(t,e,this.canvas)},t.prototype.createSurface=function(t,e){return new r.Context2DSurface(t,e)},t}();e.SurfaceFactory=n},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Context2DSurface=void 0;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(a(i(13)).Context2DSurface);e.Context2DSurface=h},function(t,e,i){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.PrimaryContext2DSurface=void 0;var n=i(60),s=i(62),a=function(t){function e(e,i,r){var o=t.call(this,e,i,r)||this,s=r.getContext("2d");if(null==s)throw new Error("PrimaryContext2DSurface#constructor: cannot get context");return o._context=new n.CanvasSurfaceContext(s),r.width=e,r.height=i,o.canvas=r,o._renderer=void 0,o}return o(e,t),e.prototype.context=function(){return this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new s.Context2DRenderer(this)),this._renderer},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;"transform"in i?(i.transformOrigin="0 0",i.transform="scale("+t+","+e+")"):"webkitTransform"in i?(i.webkitTransformOrigin="0 0",i.webkitTransform="scale("+t+","+e+")"):(i.width=Math.floor(t*this.width)+"px",i.height=Math.floor(e*this.width)+"px")},e.prototype.changePhysicalScale=function(t,e){this._context&&(this.canvas.width=this.width*t),this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=void 0,this._renderer=void 0,t.prototype.destroy.call(this)},e}(i(8).Surface);e.PrimaryContext2DSurface=a}]);